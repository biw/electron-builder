{"version":3,"file":"oneClickInstallerTest.js","sourceRoot":"","sources":["../../src/windows/oneClickInstallerTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport { copyFile, writeFile } from \"fs-extra\"\nimport * as path from \"path\"\nimport { assertThat } from \"../helpers/fileAssert\"\nimport { app, assertPack, copyTestAsset, EXTENDED_TIMEOUT, modifyPackageJson } from \"../helpers/packTester\"\nimport { checkHelpers, doTest, expectUpdateMetadata } from \"../helpers/winHelper\"\n\nconst nsisTarget = Platform.WINDOWS.createTarget([\"nsis\"], Arch.x64)\n\nfunction pickSnapshotDefines(defines: any) {\n  return {\n    APP_32_NAME: defines.APP_32_NAME,\n    APP_64_NAME: defines.APP_64_NAME,\n    APP_ARM64_NAME: defines.APP_ARM64_NAME,\n    APP_FILENAME: defines.APP_FILENAME,\n    APP_ID: defines.APP_ID,\n    APP_PACKAGE_NAME: defines.APP_PACKAGE_NAME,\n    APP_PRODUCT_FILENAME: defines.APP_PRODUCT_FILENAME,\n    COMPANY_NAME: defines.COMPANY_NAME,\n    ONE_CLICK: defines.ONE_CLICK,\n    PRODUCT_FILENAME: defines.PRODUCT_FILENAME,\n    PRODUCT_NAME: defines.PRODUCT_NAME,\n    SHORTCUT_NAME: defines.SHORTCUT_NAME,\n    UNINSTALL_DISPLAY_NAME: defines.UNINSTALL_DISPLAY_NAME,\n  }\n}\n\ntest(\"one-click\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.x64),\n      config: {\n        win: {\n          signtoolOptions: {\n            publisherName: \"Foo, Inc\",\n          },\n        },\n        publish: {\n          provider: \"generic\",\n          // tslint:disable:no-invalid-template-strings\n          url: \"https://develar.s3.amazonaws.com/test/${os}/${arch}\",\n        },\n        nsis: {\n          deleteAppDataOnUninstall: true,\n          packElevateHelper: false,\n        },\n        electronFuses: {\n          runAsNode: true,\n          enableCookieEncryption: true,\n          enableNodeOptionsEnvironmentVariable: true,\n          enableNodeCliInspectArguments: true,\n          enableEmbeddedAsarIntegrityValidation: true,\n          onlyLoadAppFromAsar: true,\n          loadBrowserProcessSpecificV8Snapshot: true,\n          grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n        },\n      },\n    },\n    {\n      signedWin: true,\n      packed: async context => {\n        await checkHelpers(expect, context.getResources(Platform.WINDOWS, Arch.x64), false)\n        await doTest(expect, context.outDir, true, \"TestApp Setup\", \"TestApp\", null, false)\n        await expectUpdateMetadata(expect, context, Arch.x64, true)\n      },\n    }\n  )\n)\n\ntest(\"custom guid\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.ia32),\n    config: {\n      appId: \"boo\",\n      productName: \"boo Hub\",\n      publish: null,\n      nsis: {\n        guid: \"Foo Technologies\\\\Bar\",\n      },\n    },\n  })\n)\n\ntest(\"multi language license\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget(\"nsis\", Arch.x64),\n      config: {\n        publish: null,\n        nsis: {\n          uninstallDisplayName: \"Hi!!!\",\n          createDesktopShortcut: false,\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          writeFile(path.join(projectDir, \"build\", \"license_en.txt\"), \"Hi\"),\n          writeFile(path.join(projectDir, \"build\", \"license_ru.txt\"), \"Привет\"),\n          writeFile(path.join(projectDir, \"build\", \"license_ko.txt\"), \"Привет\"),\n          writeFile(path.join(projectDir, \"build\", \"license_fi.txt\"), \"Привет\"),\n        ])\n      },\n    }\n  )\n)\n\ntest(\"html license\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget(\"nsis\", Arch.x64),\n      config: {\n        publish: null,\n        nsis: {\n          uninstallDisplayName: \"Hi!!!\",\n          createDesktopShortcut: false,\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          writeFile(path.join(projectDir, \"build\", \"license.html\"), '<html><body><p>Hi <a href=\"https://google.com\" target=\"_blank\">google</a></p></body></html>'),\n        ])\n      },\n    }\n  )\n)\n\ntest.ifDevOrWinCi(\"createDesktopShortcut always\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget(\"nsis\", Arch.x64),\n    config: {\n      publish: null,\n      nsis: {\n        createDesktopShortcut: \"always\",\n      },\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"perMachine, no run after finish\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.ia32),\n      config: {\n        // wine creates incorrect file names and registry entries for unicode, so, we use ASCII\n        productName: \"TestApp\",\n        fileAssociations: [\n          {\n            ext: \"foo\",\n            name: \"Test Foo\",\n          },\n        ],\n        nsis: {\n          perMachine: true,\n          runAfterFinish: false,\n        },\n        publish: {\n          provider: \"generic\",\n          // tslint:disable:no-invalid-template-strings\n          url: \"https://develar.s3.amazonaws.com/test/${os}/${arch}\",\n        },\n        win: {\n          electronUpdaterCompatibility: \">=2.16\",\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          copyTestAsset(\"headerIcon.ico\", path.join(projectDir, \"build\", \"foo test space.ico\")),\n          copyTestAsset(\"license.txt\", path.join(projectDir, \"build\", \"license.txt\")),\n        ])\n      },\n      packed: async context => {\n        await expectUpdateMetadata(expect, context)\n        await checkHelpers(expect, context.getResources(Platform.WINDOWS, Arch.ia32), true)\n        await doTest(expect, context.outDir, false)\n      },\n    }\n  )\n)\n\ntest.skip(\"installerHeaderIcon\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) => {\n  let headerIconPath: string | null = null\n  return assertPack(\n    expect,\n    \"test-app-one\",\n    {\n      targets: nsisTarget,\n      effectiveOptionComputed: async it => {\n        const defines = it[0]\n        expect(defines.HEADER_ICO).toEqual(headerIconPath)\n        return Promise.resolve(false)\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        headerIconPath = path.join(projectDir, \"build\", \"installerHeaderIcon.ico\")\n        return Promise.all([copyTestAsset(\"headerIcon.ico\", headerIconPath), copyTestAsset(\"headerIcon.ico\", path.join(projectDir, \"build\", \"uninstallerIcon.ico\"))])\n      },\n    }\n  )\n})\n\ntest.ifDevOrLinuxCi(\"custom include\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    { targets: nsisTarget },\n    {\n      projectDirCreated: projectDir => copyTestAsset(\"installer.nsh\", path.join(projectDir, \"build\", \"installer.nsh\")),\n      packed: context =>\n        Promise.all([\n          assertThat(expect, path.join(context.projectDir, \"build\", \"customHeader\")).isFile(),\n          assertThat(expect, path.join(context.projectDir, \"build\", \"customInit\")).isFile(),\n          assertThat(expect, path.join(context.projectDir, \"build\", \"customInstall\")).isFile(),\n        ]),\n    }\n  )\n)\n\ntest.skip(\"big file pack\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: nsisTarget,\n      config: {\n        extraResources: [\"**/*.mov\"],\n        nsis: {\n          differentialPackage: false,\n        },\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await copyFile(\"/Volumes/Pegasus/15.02.18.m4v\", path.join(projectDir, \"foo/bar/video.mov\"))\n      },\n    }\n  )\n)\n\ntest.ifDevOrLinuxCi(\"custom script\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    { targets: nsisTarget },\n    {\n      projectDirCreated: projectDir => copyTestAsset(\"installer.nsi\", path.join(projectDir, \"build\", \"installer.nsi\")),\n      packed: context => assertThat(expect, path.join(context.projectDir, \"build\", \"customInstallerScript\")).isFile(),\n    }\n  )\n)\n\ntest(\"menuCategory\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.ia32),\n      config: {\n        extraMetadata: {\n          name: \"test-menu-category\",\n          productName: \"Test Menu Category\",\n        },\n        publish: null,\n        nsis: {\n          oneClick: false,\n          menuCategory: true,\n          artifactName: \"${productName} CustomName ${version}.${ext}\",\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.name = \"test-menu-category\"\n        }),\n      packed: context => {\n        return doTest(expect, context.outDir, false, \"Test Menu Category\", \"test-menu-category\", \"Foo Bar\")\n      },\n    }\n  )\n)\n\ntest(\"string menuCategory\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.ia32),\n      config: {\n        extraMetadata: {\n          name: \"test-menu-category\",\n          productName: \"Test Menu Category '\",\n        },\n        publish: null,\n        nsis: {\n          oneClick: false,\n          runAfterFinish: false,\n          menuCategory: \"Foo/Bar\",\n          // tslint:disable-next-line:no-invalid-template-strings\n          artifactName: \"${productName} CustomName ${version}.${ext}\",\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.name = \"test-menu-category\"\n        }),\n      packed: async context => {\n        await doTest(expect, context.outDir, false, \"Test Menu Category\", \"test-menu-category\", \"Foo Bar\")\n      },\n    }\n  )\n)\n\ntest.ifDevOrLinuxCi(\"file associations per user\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget([\"nsis\"], Arch.ia32),\n    config: {\n      publish: null,\n      fileAssociations: [\n        {\n          ext: \"foo\",\n          name: \"Test Foo\",\n        },\n      ],\n    },\n  })\n)\n\ntest.ifWindows.skip(\"custom exec name\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(expect, {\n    targets: nsisTarget,\n    config: {\n      productName: \"foo\",\n      win: {\n        executableName: \"Boo\",\n      },\n      electronFuses: {\n        runAsNode: true,\n        enableCookieEncryption: true,\n        enableNodeOptionsEnvironmentVariable: true,\n        enableNodeCliInspectArguments: true,\n        enableEmbeddedAsarIntegrityValidation: true,\n        onlyLoadAppFromAsar: true,\n        loadBrowserProcessSpecificV8Snapshot: true,\n        grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n      },\n    },\n    effectiveOptionComputed: async it => {\n      expect(pickSnapshotDefines(it[0])).toMatchSnapshot()\n      return Promise.resolve(false)\n    },\n  })\n)\n\ntest.ifWindows.skip(\"top-level custom exec name\", { timeout: EXTENDED_TIMEOUT }, ({ expect }) =>\n  app(expect, {\n    targets: nsisTarget,\n    config: {\n      publish: null,\n      productName: \"foo\",\n      executableName: \"Boo\",\n    },\n    effectiveOptionComputed: async it => {\n      expect(pickSnapshotDefines(it[0])).toMatchSnapshot()\n      return Promise.resolve(false)\n    },\n  })\n)\n"]}