{"version":3,"file":"macIconTest.js","sourceRoot":"","sources":["../../src/mac/macIconTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { parsePlistFile, PlistObject } from \"app-builder-lib/out/util/plist\"\nimport { Arch, DIR_TARGET, Platform } from \"electron-builder\"\nimport * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { CheckingMacPackager } from \"../helpers/CheckingPackager\"\nimport { app } from \"../helpers/packTester\"\nimport { ExpectStatic } from \"vitest\"\n\nasync function assertIcon(expect: ExpectStatic, platformPackager: CheckingMacPackager) {\n  const file = await platformPackager.getIconPath()\n  expect(file).toBeDefined()\n\n  const result = await platformPackager.resolveIcon([file!], [], \"set\")\n  result.forEach(it => {\n    it.file = path.basename(it.file)\n  })\n  expect(result).toMatchSnapshot()\n}\n\nconst targets = Platform.MAC.createTarget(DIR_TARGET, Arch.x64)\n\nconst iconComposerFixture = path.join(__dirname, \"..\", \"..\", \"fixtures\", \"macos-icon-composer-assets\", \"electron.icon\")\n\ntest.ifMac(\"icon composer generate asset catalog\", ({ expect }) => {\n  return app(\n    expect,\n    {\n      targets,\n      config: {\n        mac: {\n          icon: \"icon.icon\",\n        },\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await Promise.all([fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")), fs.unlink(path.join(projectDir, \"build\", \"icon.ico\"))])\n\n        await fs.cp(iconComposerFixture, path.join(projectDir, \"build\", \"icon.icon\"), {\n          recursive: true,\n        })\n      },\n      packed: async context => {\n        const resourcesDir = context.getResources(Platform.MAC, Arch.x64)\n        const contentsDir = context.getContent(Platform.MAC, Arch.x64)\n        const infoPlistPath = path.join(contentsDir, \"Info.plist\")\n\n        const info = await parsePlistFile<PlistObject>(infoPlistPath)\n        expect(info.CFBundleIconName).toBe(\"Icon\")\n        expect(info.CFBundleIconFile).toBe(\"icon.icns\")\n\n        const assetCatalogPath = path.join(resourcesDir, \"Assets.car\")\n        const writtenCatalog = await fs.readFile(assetCatalogPath)\n        expect(writtenCatalog.length).toBeGreaterThan(0)\n      },\n    }\n  )\n})\n\ntest.ifMac(\"icon set\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir => Promise.all([fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")), fs.unlink(path.join(projectDir, \"build\", \"icon.ico\"))]),\n      packed: () => assertIcon(expect, platformPackager!),\n    }\n  )\n})\n\ntest.ifMac(\"custom icon set\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      config: {\n        mac: {\n          icon: \"customIconSet\",\n        },\n      },\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir =>\n        Promise.all([\n          fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")),\n          fs.unlink(path.join(projectDir, \"build\", \"icon.ico\")),\n          fs.rename(path.join(projectDir, \"build\", \"icons\"), path.join(projectDir, \"customIconSet\")),\n        ]),\n      packed: () => assertIcon(expect, platformPackager!),\n    }\n  )\n})\n\ntest.ifMac(\"custom icon set with only 512 and 128\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      config: {\n        mac: {\n          icon: \"..\",\n        },\n      },\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir =>\n        Promise.all([\n          fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")),\n          fs.unlink(path.join(projectDir, \"build\", \"icon.ico\")),\n          fs.copyFile(path.join(projectDir, \"build\", \"icons\", \"512x512.png\"), path.join(projectDir, \"512x512.png\")),\n          fs.copyFile(path.join(projectDir, \"build\", \"icons\", \"128x128.png\"), path.join(projectDir, \"128x128.png\")),\n        ]),\n      packed: () => assertIcon(expect, platformPackager!),\n    }\n  )\n})\n\ntest.ifMac(\"png icon\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      config: {\n        mac: {\n          icon: \"icons/512x512.png\",\n        },\n      },\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir => Promise.all([fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")), fs.unlink(path.join(projectDir, \"build\", \"icon.ico\"))]),\n      packed: () => assertIcon(expect, platformPackager!),\n    }\n  )\n})\n\ntest.ifMac(\"default png icon\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir =>\n        Promise.all([\n          fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")),\n          fs.unlink(path.join(projectDir, \"build\", \"icon.ico\")),\n          fs\n            .copyFile(path.join(projectDir, \"build\", \"icons\", \"512x512.png\"), path.join(projectDir, \"build\", \"icon.png\"))\n            .then(() => fs.rm(path.join(projectDir, \"build\", \"icons\"), { recursive: true, force: true })),\n        ]),\n      packed: () => assertIcon(expect, platformPackager!),\n    }\n  )\n})\n\ntest.ifMac(\"png icon small\", ({ expect }) => {\n  let platformPackager: CheckingMacPackager | null = null\n  return app(\n    expect,\n    {\n      targets,\n      config: {\n        mac: {\n          icon: \"icons/128x128.png\",\n        },\n      },\n      platformPackagerFactory: packager => (platformPackager = new CheckingMacPackager(packager)),\n    },\n    {\n      projectDirCreated: projectDir => Promise.all([fs.unlink(path.join(projectDir, \"build\", \"icon.icns\")), fs.unlink(path.join(projectDir, \"build\", \"icon.ico\"))]),\n      packed: async () => {\n        try {\n          await platformPackager!.getIconPath()\n        } catch (e: any) {\n          if (!e.message.includes(\"must be at least 512x512\")) {\n            throw e\n          }\n          return\n        }\n\n        throw new Error(\"error expected\")\n      },\n    }\n  )\n})\n"]}