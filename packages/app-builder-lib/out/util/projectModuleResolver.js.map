{"version":3,"file":"projectModuleResolver.js","sourceRoot":"","sources":["../../src/util/projectModuleResolver.ts"],"names":[],"mappings":";;AAsBA,gDAwCC;AASD,sDAQC;AA/ED,+CAAkC;AAClC,6BAA4B;AAC5B,yBAAwB;AAWxB;;;;;;;;GAQG;AACH,SAAgB,kBAAkB,CAAC,OAAkC;IACnE,MAAM,EAAE,UAAU,EAAE,eAAe,EAAE,QAAQ,GAAG,KAAK,EAAE,GAAG,OAAO,CAAA;IAEjE,uCAAuC;IACvC,gDAAgD;IAChD,MAAM,WAAW,GAAa,EAAE,CAAA;IAChC,IAAI,UAAU,GAAG,UAAU,CAAA;IAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAA;IAExC,OAAO,UAAU,KAAK,IAAI,EAAE,CAAC;QAC3B,MAAM,eAAe,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,cAAc,CAAC,CAAA;QAC7D,IAAI,EAAE,CAAC,UAAU,CAAC,eAAe,CAAC,EAAE,CAAC;YACnC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC9B,CAAC;QACD,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAA;QAC1C,IAAI,SAAS,KAAK,UAAU;YAAE,MAAK;QACnC,UAAU,GAAG,SAAS,CAAA;IACxB,CAAC;IAED,wDAAwD;IACxD,IAAI,WAAW,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QAC7B,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;IAC9B,CAAC;IAED,IAAI,CAAC;QACH,MAAM,QAAQ,GAAG,OAAO,CAAC,OAAO,CAAC,eAAe,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC,CAAA;QACzE,kBAAG,CAAC,KAAK,CAAC,EAAE,eAAe,EAAE,QAAQ,EAAE,EAAE,sCAAsC,CAAC,CAAA;QAChF,OAAO,QAAQ,CAAA;IACjB,CAAC;IAAC,OAAO,KAAU,EAAE,CAAC;QACpB,IAAI,QAAQ,EAAE,CAAC;YACb,kBAAG,CAAC,KAAK,CAAC,EAAE,eAAe,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,sCAAsC,CAAC,CAAA;YACxG,OAAO,IAAI,CAAA;QACb,CAAC;QACD,MAAM,IAAI,KAAK,CACb,0BAA0B,eAAe,6BAA6B,UAAU,KAAK;YACnF,iDAAiD;YACjD,0EAA0E;YAC1E,mBAAmB,KAAK,CAAC,OAAO,EAAE,CACrC,CAAA;IACH,CAAC;AACH,CAAC;AAED;;;;;;GAMG;AACH,SAAgB,qBAAqB,CAAC,UAAkB,EAAE,eAAuB;IAC/E,OAAO,CACL,kBAAkB,CAAC;QACjB,UAAU;QACV,eAAe;QACf,QAAQ,EAAE,IAAI;KACf,CAAC,KAAK,IAAI,CACZ,CAAA;AACH,CAAC","sourcesContent":["import { log } from \"builder-util\"\nimport * as path from \"path\"\nimport * as fs from \"fs\"\n\nexport interface ResolveFromProjectOptions {\n  /** The project directory to resolve from */\n  projectDir: string\n  /** Module specifier (e.g., \"electron-webpack/out/electron-builder.js\") */\n  moduleSpecifier: string\n  /** If true, returns null instead of throwing when module not found */\n  optional?: boolean\n}\n\n/**\n * Resolves a module from the user's project directory context.\n * This is necessary for pnpm compatibility where modules can only\n * require their direct dependencies.\n *\n * @param options Resolution options\n * @returns The resolved module path, or null if optional and not found\n * @throws Error if module not found and not optional\n */\nexport function resolveFromProject(options: ResolveFromProjectOptions): string | null {\n  const { projectDir, moduleSpecifier, optional = false } = options\n\n  // Build the paths array for resolution\n  // Start from project's node_modules and walk up\n  const searchPaths: string[] = []\n  let currentDir = projectDir\n  const root = path.parse(currentDir).root\n\n  while (currentDir !== root) {\n    const nodeModulesPath = path.join(currentDir, \"node_modules\")\n    if (fs.existsSync(nodeModulesPath)) {\n      searchPaths.push(currentDir)\n    }\n    const parentDir = path.dirname(currentDir)\n    if (parentDir === currentDir) break\n    currentDir = parentDir\n  }\n\n  // If no paths found, at least try the project directory\n  if (searchPaths.length === 0) {\n    searchPaths.push(projectDir)\n  }\n\n  try {\n    const resolved = require.resolve(moduleSpecifier, { paths: searchPaths })\n    log.debug({ moduleSpecifier, resolved }, \"resolved module from project context\")\n    return resolved\n  } catch (error: any) {\n    if (optional) {\n      log.debug({ moduleSpecifier, projectDir, error: error.message }, \"optional module not found in project\")\n      return null\n    }\n    throw new Error(\n      `Cannot resolve module \"${moduleSpecifier}\" from project directory \"${projectDir}\". ` +\n        `This module must be installed in your project. ` +\n        `If you're using pnpm, ensure the module is listed in your dependencies. ` +\n        `Original error: ${error.message}`\n    )\n  }\n}\n\n/**\n * Checks if a module exists in the user's project context.\n *\n * @param projectDir The project directory\n * @param moduleSpecifier The module to check for\n * @returns true if the module can be resolved\n */\nexport function moduleExistsInProject(projectDir: string, moduleSpecifier: string): boolean {\n  return (\n    resolveFromProject({\n      projectDir,\n      moduleSpecifier,\n      optional: true,\n    }) !== null\n  )\n}\n"]}