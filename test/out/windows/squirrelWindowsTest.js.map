{"version":3,"file":"squirrelWindowsTest.js","sourceRoot":"","sources":["../../src/windows/squirrelWindowsTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport * as path from \"path\"\nimport { CheckingWinPackager } from \"../helpers/CheckingPackager\"\nimport { app, assertPack, copyTestAsset } from \"../helpers/packTester\"\n\ndescribe(\"squirrel.windows\", { sequential: true }, () => {\n  test.ifNotCiMac(\"Squirrel.Windows\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget([\"squirrel\"]),\n        config: {\n          win: {\n            compression: \"normal\",\n          },\n          executableName: \"test with spaces\",\n          electronFuses: {\n            runAsNode: true,\n            enableCookieEncryption: true,\n            enableNodeOptionsEnvironmentVariable: true,\n            enableNodeCliInspectArguments: true,\n            enableEmbeddedAsarIntegrityValidation: true,\n            onlyLoadAppFromAsar: true,\n            loadBrowserProcessSpecificV8Snapshot: true,\n            grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n          },\n        },\n      },\n      { signedWin: true }\n    )\n  )\n\n  test.ifNotCiMac(\"artifactName\", ({ expect }) =>\n    app(expect, {\n      targets: Platform.WINDOWS.createTarget([\"squirrel\", \"zip\"]),\n      config: {\n        win: {\n          // tslint:disable:no-invalid-template-strings\n          artifactName: \"Test ${name} foo.${ext}\",\n        },\n      },\n    })\n  )\n\n  // very slow\n  test.skip(\"delta and msi\", ({ expect }) =>\n    app(expect, {\n      targets: Platform.WINDOWS.createTarget(\"squirrel\", Arch.ia32),\n      config: {\n        squirrelWindows: {\n          remoteReleases: \"https://github.com/develar/__test-app-releases\",\n          msi: true,\n        },\n      },\n    }))\n\n  test(\"squirrel window arm64 msi\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"squirrel\", Arch.arm64),\n        config: {\n          squirrelWindows: {\n            msi: true,\n          },\n        },\n      },\n      { signedWin: true }\n    ))\n\n  test(\"squirrel window x64 msi\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"squirrel\", Arch.x64),\n        config: {\n          squirrelWindows: {\n            msi: true,\n          },\n        },\n      },\n      { signedWin: true }\n    ))\n\n  test(\"squirrel window ia32 msi\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"squirrel\", Arch.ia32),\n        config: {\n          squirrelWindows: {\n            msi: true,\n          },\n        },\n      },\n      { signedWin: true }\n    ))\n\n  test(\"detect install-spinner\", ({ expect }) => {\n    let platformPackager: CheckingWinPackager | null = null\n    let loadingGifPath: string | null = null\n\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      {\n        targets: Platform.WINDOWS.createTarget(\"squirrel\"),\n        platformPackagerFactory: (packager, platform) => (platformPackager = new CheckingWinPackager(packager)),\n      },\n      {\n        projectDirCreated: it => {\n          loadingGifPath = path.join(it, \"build\", \"install-spinner.gif\")\n          return copyTestAsset(\"install-spinner.gif\", loadingGifPath)\n        },\n        packed: async () => {\n          expect(platformPackager!.effectiveDistOptions.loadingGif).toEqual(loadingGifPath)\n        },\n      }\n    )\n  })\n})\n"]}