{"version":3,"file":"debTest.js","sourceRoot":"","sources":["../../src/linux/debTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport * as fs from \"fs/promises\"\nimport { app, execShell, getTarExecutable } from \"../helpers/packTester\"\n\nconst defaultDebTarget = Platform.LINUX.createTarget(\"deb\", Arch.x64)\n\ntest.ifNotWindows(\"deb\", ({ expect }) =>\n  app(expect, {\n    targets: defaultDebTarget,\n  })\n)\n\ntest.ifNotWindows(\"arm\", ({ expect }) => app(expect, { targets: Platform.LINUX.createTarget(\"deb\", Arch.armv7l, Arch.arm64) }))\n\ntest.ifNotWindows(\"custom depends\", ({ expect }) =>\n  app(expect, {\n    targets: defaultDebTarget,\n    config: {\n      linux: {\n        executableName: \"Boo\",\n      },\n      deb: {\n        depends: [\"foo\"],\n      },\n      electronFuses: {\n        runAsNode: true,\n        enableCookieEncryption: true,\n        enableNodeOptionsEnvironmentVariable: true,\n        enableNodeCliInspectArguments: true,\n        enableEmbeddedAsarIntegrityValidation: true,\n        onlyLoadAppFromAsar: true,\n        loadBrowserProcessSpecificV8Snapshot: true,\n        grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n      },\n    },\n  })\n)\n\ntest.ifNotWindows(\"top-level exec name\", ({ expect }) =>\n  app(expect, {\n    targets: defaultDebTarget,\n    config: {\n      productName: \"foo\",\n      executableName: \"Boo\",\n    },\n  })\n)\n\ntest.ifNotWindows(\"no quotes for safe exec name\", ({ expect }) =>\n  app(expect, {\n    targets: defaultDebTarget,\n    config: {\n      productName: \"foo\",\n      linux: {\n        executableName: \"Boo\",\n      },\n    },\n    effectiveOptionComputed: async it => {\n      const content = await fs.readFile(it[1], \"utf8\")\n      expect(content).toMatchSnapshot()\n      return false\n    },\n  })\n)\n\ntest.ifNotWindows(\"executable path in postinst script\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: defaultDebTarget,\n      config: {\n        productName: \"foo\",\n        linux: {\n          executableName: \"Boo\",\n        },\n      },\n    },\n    {\n      packed: async context => {\n        const postinst = (\n          await execShell(`ar p '${context.outDir}/TestApp_1.1.0_amd64.deb' control.tar.xz | ${await getTarExecutable()} -Jx --to-stdout ./postinst`, {\n            maxBuffer: 10 * 1024 * 1024,\n          })\n        ).stdout\n        expect(postinst.trim()).toMatchSnapshot()\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"deb file associations\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: defaultDebTarget,\n      config: {\n        fileAssociations: [\n          {\n            ext: \"my-app\",\n            name: \"Test Foo\",\n            mimeType: \"application/x-example\",\n          },\n        ],\n      },\n    },\n    {\n      packed: async context => {\n        const mime = (\n          await execShell(`ar p '${context.outDir}/TestApp_1.1.0_amd64.deb' data.tar.xz | ${await getTarExecutable()} -Jx --to-stdout './usr/share/mime/packages/testapp.xml'`, {\n            maxBuffer: 10 * 1024 * 1024,\n          })\n        ).stdout\n        expect(mime.trim()).toMatchSnapshot()\n      },\n    }\n  )\n)\n"]}