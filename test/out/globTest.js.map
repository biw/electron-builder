{"version":3,"file":"globTest.js","sourceRoot":"","sources":["../src/globTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from \"app-builder-lib\"\nimport { readAsar } from \"app-builder-lib/out/asar/asar\"\nimport { PM } from \"app-builder-lib/out/node-module-collector/packageManager\"\nimport { outputFile } from \"fs-extra\"\nimport * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { ExpectStatic } from \"vitest\"\nimport { assertThat } from \"./helpers/fileAssert\"\nimport { app, appThrows, assertPack, linuxDirTarget, modifyPackageJson, PackedContext, removeUnstableProperties, verifyAsarFileTree } from \"./helpers/packTester\"\nimport { verifySmartUnpack } from \"./helpers/verifySmartUnpack\"\n\nasync function createFiles(appDir: string) {\n  await Promise.all([\n    outputFile(path.join(appDir, \"assets\", \"file1\"), \"data\"),\n    outputFile(path.join(appDir, \"assets\", \"file2\"), \"data\"),\n    outputFile(path.join(appDir, \"assets\", \"subdir\", \"file3\"), \"data\"),\n    outputFile(path.join(appDir, \"b2\", \"file\"), \"data\"),\n    outputFile(path.join(appDir, \"do-not-unpack-dir\", \"file.json\"), \"{}\").then(() => fs.writeFile(path.join(appDir, \"do-not-unpack-dir\", \"must-be-not-unpacked\"), \"{}\")),\n  ])\n\n  const dir = path.join(appDir, \"do-not-unpack-dir\", \"dir-2\", \"dir-3\", \"dir-3\")\n  await fs.mkdir(dir, { recursive: true })\n  await fs.writeFile(path.join(dir, \"file-in-asar\"), \"{}\")\n\n  await fs.symlink(path.join(appDir, \"assets\", \"file1\"), path.join(appDir, \"assets\", \"subdir\", \"file-symlink1\")) // \"reverse\" symlink up one directory\n  await fs.symlink(path.join(appDir, \"assets\", \"file2\"), path.join(appDir, \"assets\", \"file-symlink2\")) // same dir symlink\n  await fs.symlink(path.join(appDir, \"assets\", \"subdir\", \"file3\"), path.join(appDir, \"file-symlink3\")) // symlink down\n}\n\ntest.ifNotWindows.ifDevOrLinuxCi(\"unpackDir one\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        asarUnpack: [\"assets\", \"b2\", \"do-not-unpack-dir/file.json\"],\n      },\n    },\n    {\n      projectDirCreated: createFiles,\n      packed: context => assertDirs(expect, context),\n    }\n  )\n)\n\nasync function assertDirs(expect: ExpectStatic, context: PackedContext) {\n  const resourceDir = context.getResources(Platform.LINUX)\n  await Promise.all([\n    assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"assets\")).isDirectory(),\n    assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"b2\")).isDirectory(),\n    assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"do-not-unpack-dir\", \"file.json\")).isFile(),\n    assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"do-not-unpack-dir\", \"must-be-not-unpacked\")).doesNotExist(),\n    assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"do-not-unpack-dir\", \"dir-2\")).doesNotExist(),\n  ])\n\n  await verifyAsarFileTree(expect, resourceDir)\n}\n\ntest.ifNotWindows.ifDevOrLinuxCi(\"unpackDir\", ({ expect }) => {\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets: linuxDirTarget,\n      config: {\n        asarUnpack: [\"assets\", \"b2\", \"do-not-unpack-dir/file.json\"],\n      },\n    },\n    {\n      projectDirCreated: projectDir => createFiles(path.join(projectDir, \"app\")),\n      packed: context => assertDirs(expect, context),\n    }\n  )\n})\n\ntest.ifDevOrLinuxCi(\"asarUnpack and files ignore\", ({ expect }) => {\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets: linuxDirTarget,\n      config: {\n        asarUnpack: [\"!**/ffprobe-static/bin/darwin/x64/ffprobe\"],\n      },\n    },\n    {\n      projectDirCreated: projectDir => outputFile(path.join(projectDir, \"test/ffprobe-static/bin/darwin/x64/ffprobe\"), \"data\"),\n      packed: async context => {\n        const resourceDir = context.getResources(Platform.LINUX)\n        await Promise.all([assertThat(expect, path.join(resourceDir, \"app.asar.unpacked\", \"test/ffprobe-static/bin/darwin/x64/ffprobe\")).doesNotExist()])\n\n        await verifyAsarFileTree(expect, resourceDir)\n      },\n    }\n  )\n})\n\ntest.ifNotWindows(\"link\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      projectDirCreated: projectDir => {\n        return fs.symlink(path.join(projectDir, \"index.js\"), path.join(projectDir, \"foo.js\"))\n      },\n      packed: async context => {\n        const resources = context.getResources(Platform.LINUX)\n        expect((await readAsar(path.join(resources, \"app.asar\"))).getFile(\"foo.js\", false)).toMatchSnapshot()\n        await verifyAsarFileTree(expect, resources)\n      },\n    }\n  )\n)\n\ntest.skip(\"outside link\", ({ expect }) =>\n  appThrows(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      projectDirCreated: async (projectDir, tmpDir) => {\n        const tempDir = await tmpDir.getTempDir()\n        await outputFile(path.join(tempDir, \"foo\"), \"data\")\n        await fs.symlink(tempDir, path.join(projectDir, \"o-dir\"))\n      },\n    },\n    error => {\n      expect(error).toBeInstanceOf(Error)\n      expect(error.message).toContain(\"outside the package to a system or unsafe path\")\n    }\n  ))\ntest.ifNotWindows(\"symlinks everywhere with static framework\", ({ expect }) =>\n  assertPack(\n    expect,\n    \"test-app-symlink-framework\",\n    {\n      targets: linuxDirTarget,\n      config: {\n        files: [\"!hello-world\"],\n      },\n    },\n    {\n      packageManager: PM.NPM,\n      projectDirCreated: async projectDir => {\n        await modifyPackageJson(projectDir, data => {\n          data.dependencies = {\n            debug: \"4.1.1\",\n            ...data.dependencies,\n          }\n        })\n        await fs.symlink(path.join(projectDir, \"index.js\"), path.join(projectDir, \"foo.js\"))\n      },\n      packed: async context => {\n        const resources = context.getResources(Platform.LINUX)\n        expect((await readAsar(path.join(resources, \"app.asar\"))).getFile(\"foo.js\", false)).toMatchSnapshot()\n        await verifySmartUnpack(expect, resources)\n      },\n    }\n  )\n)\n\n// https://github.com/electron-userland/electron-builder/issues/611\ntest.ifDevOrLinuxCi(\"failed peer dep\", ({ expect }) => {\n  return assertPack(\n    expect,\n    \"test-app-one\",\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      packageManager: PM.YARN,\n      projectDirCreated: async projectDir => {\n        return Promise.all([\n          modifyPackageJson(projectDir, data => {\n            //noinspection SpellCheckingInspection\n            data.dependencies = {\n              debug: \"4.1.1\",\n              \"rc-datepicker\": \"4.0.0\",\n              react: \"15.2.1\",\n              \"react-dom\": \"15.2.1\",\n            }\n          }),\n        ])\n      },\n      packed: context => {\n        return verifySmartUnpack(expect, context.getResources(Platform.LINUX))\n      },\n    }\n  )\n})\n\ntest.ifDevOrLinuxCi(\"ignore node_modules\", ({ expect }) => {\n  return assertPack(\n    expect,\n    \"test-app-one\",\n    {\n      targets: linuxDirTarget,\n      config: {\n        asar: false,\n        files: [\"!node_modules/**/*\"],\n      },\n    },\n    {\n      packageManager: PM.NPM,\n      projectDirCreated: async projectDir => {\n        return modifyPackageJson(projectDir, data => {\n          //noinspection SpellCheckingInspection\n          data.dependencies = {\n            \"ci-info\": \"2.0.0\",\n            // this contains string-width-cjs 4.2.3\n            \"@isaacs/cliui\": \"8.0.2\",\n          }\n        })\n      },\n      packed: context => {\n        return assertThat(expect, path.join(context.getResources(Platform.LINUX), \"app\", \"node_modules\")).doesNotExist()\n      },\n    }\n  )\n})\n\ntest.ifDevOrLinuxCi(\"asarUnpack node_modules\", ({ expect }) => {\n  return assertPack(\n    expect,\n    \"test-app-one\",\n    {\n      targets: linuxDirTarget,\n      config: {\n        asarUnpack: \"node_modules\",\n      },\n    },\n    {\n      packageManager: PM.NPM,\n      projectDirCreated: async projectDir => {\n        return modifyPackageJson(projectDir, data => {\n          data.dependencies = {\n            \"ci-info\": \"2.0.0\",\n          }\n        })\n      },\n      packed: async context => {\n        const nodeModulesNode = (await readAsar(path.join(context.getResources(Platform.LINUX), \"app.asar\"))).getNode(\"node_modules\")\n        expect(removeUnstableProperties(nodeModulesNode)).toMatchSnapshot()\n        await assertThat(expect, path.join(context.getResources(Platform.LINUX), \"app.asar.unpacked/node_modules/ci-info\")).isDirectory()\n      },\n    }\n  )\n})\n"]}