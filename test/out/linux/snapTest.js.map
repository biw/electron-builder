{"version":3,"file":"snapTest.js","sourceRoot":"","sources":["../../src/linux/snapTest.ts"],"names":[],"mappings":";;AAAA,uDAAiD;AACjD,sDAAmE;AAEnE,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACzC,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,aAAa,EAAE;YACb,SAAS,EAAE,IAAI;YACf,sBAAsB,EAAE,IAAI;YAC5B,oCAAoC,EAAE,IAAI;YAC1C,6BAA6B,EAAE,IAAI;YACnC,qCAAqC,EAAE,IAAI;YAC3C,mBAAmB,EAAE,IAAI;YACzB,oCAAoC,EAAE,IAAI;YAC1C,gCAAgC,EAAE,SAAS,EAAE,uDAAuD;SACrG;KACF;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACxC,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,2BAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,EAAE,uBAAI,CAAC,MAAM,CAAC;IACzD,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;KACnB;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,uBAAuB,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE;IAChE,KAAK,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,SAAS,EAAE,MAAM,CAAC,CAAC,EAAE,CAAC;QACzG,MAAM,IAAA,uBAAU,EAAC,MAAM,EAAE,cAAc,EAAE;YACvC,OAAO,EAAE,uBAAU;YACnB,MAAM,EAAE;gBACN,aAAa,EAAE;oBACb,IAAI,EAAE,KAAK;iBACZ;gBACD,WAAW,EAAE,KAAK;gBAClB,IAAI,EAAE;oBACJ,aAAa,EAAE,CAAC;oBAChB,KAAK,EAAE,CAAC;oBACR,WAAW,EAAE,SAAS;oBACtB,oCAAoC;oBACpC,cAAc,EAAE,KAAK;iBACtB;aACF;YACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;gBAChD,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAA;gBAC5B,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;gBAC9B,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,CAAA;gBACvC,OAAO,IAAI,CAAA;YACb,CAAC;SACF,CAAC,CAAA;IACJ,CAAC;AACH,CAAC,CAAC,CAAA;AAEF,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACxD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,WAAW;SAClB;QACD,WAAW,EAAE,yCAAyC;QACtD,IAAI,EAAE;YACJ,WAAW,EAAE,SAAS;SACvB;KACF;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE;IACxD,MAAM,IAAA,uBAAU,EAAC,MAAM,EAAE,cAAc,EAAE;QACvC,OAAO,EAAE,uBAAU;QACnB,MAAM,EAAE;YACN,aAAa,EAAE;gBACb,IAAI,EAAE,KAAK;aACZ;YACD,WAAW,EAAE,KAAK;YAClB,IAAI,EAAE;gBACJ,aAAa,EAAE,CAAC,MAAM,EAAE,SAAS,EAAE,MAAM,CAAC;gBAC1C,oCAAoC;gBACpC,cAAc,EAAE,KAAK;aACtB;SACF;QACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;YAC1C,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAA;YAC5B,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;YAC9B,OAAO,IAAI,CAAA;QACb,CAAC;KACF,CAAC,CAAA;AACJ,CAAC,CAAC,CAAA;AAEF,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE;IACvD,KAAK,MAAM,CAAC,IAAI;QACd;YACE;gBACE,iBAAiB,EAAE;oBACjB,SAAS,EAAE,iBAAiB;oBAC5B,eAAe,EAAE,IAAI;iBACtB;aACF;YACD,0BAA0B;SAC3B;QACD;YACE,iBAAiB,EAAE;gBACjB,SAAS,EAAE,iBAAiB;gBAC5B,eAAe,EAAE,IAAI;aACtB;YACD,0BAA0B,EAAE,IAAI;SACjC;KACF,EAAE,CAAC;QACF,MAAM,IAAA,uBAAU,EAAC,MAAM,EAAE,cAAc,EAAE;YACvC,OAAO,EAAE,uBAAU;YACnB,MAAM,EAAE;gBACN,IAAI,EAAE;oBACJ,KAAK,EAAE,CAAC;oBACR,oCAAoC;oBACpC,cAAc,EAAE,KAAK;iBACtB;aACF;YACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;gBAChD,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAA;gBAC5B,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;gBAC9B,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,CAAA;gBACvC,OAAO,IAAI,CAAA;YACb,CAAC;SACF,CAAC,CAAA;IACJ,CAAC;AACH,CAAC,CAAC,CAAA;AAEF,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE;IACvD,KAAK,MAAM,KAAK,IAAI;QAClB,CAAC,KAAK,EAAE,KAAK,CAAC;QACd;YACE;gBACE,KAAK,EAAE;oBACL,SAAS,EAAE,OAAO;oBAClB,IAAI,EAAE,UAAU;iBACjB;aACF;YACD,0BAA0B;SAC3B;KACF,EAAE,CAAC;QACF,MAAM,IAAA,uBAAU,EAAC,MAAM,EAAE,cAAc,EAAE;YACvC,OAAO,EAAE,uBAAU;YACnB,MAAM,EAAE;gBACN,aAAa,EAAE;oBACb,IAAI,EAAE,KAAK;iBACZ;gBACD,WAAW,EAAE,KAAK;gBAClB,IAAI,EAAE;oBACJ,KAAK;iBACN;aACF;YACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;gBAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;gBAC9B,OAAO,IAAI,CAAA;YACb,CAAC;SACF,CAAC,CAAA;IACJ,CAAC;AACH,CAAC,CAAC,CAAA;AAEF,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAC/C,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,WAAW,EAAE;gBACX,GAAG,EAAE,KAAK;aACX;SACF;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;QAC1C,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,0BAA0B,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAC7D,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,KAAK,EAAE,CAAC,KAAK,CAAC;SACf;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;QAC1C,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACrD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,KAAK,EAAE,CAAC,KAAK,EAAE,KAAK,CAAC;SACtB;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC,CAAA;QACnC,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAC/C,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,SAAS,EAAE,IAAI;SAChB;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,aAAa,CAAC,CAAA;QACtD,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACxD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;KACnB;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,oBAAoB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACvD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,aAAa,EAAE;YACb,IAAI,EAAE,KAAK;SACZ;QACD,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,cAAc,EAAE,KAAK;YACrB,WAAW,EAAE,IAAI;SAClB;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QACnC,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;QACrE,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACjD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,WAAW,EAAE,KAAK;KACnB;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;QAC1C,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAChC,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAChD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,WAAW,EAAE,KAAK;QAClB,IAAI,EAAE;YACJ,IAAI,EAAE,QAAQ;SACf;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE;QAC1C,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAChC,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACrD,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,uBAAU;IACnB,MAAM,EAAE;QACN,IAAI,EAAE;YACJ,cAAc,EAAE,IAAI;YACpB,WAAW,EAAE,IAAI;SAClB;KACF;IACD,uBAAuB,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,EAAE,EAAE;QAChD,MAAM,CAAC,IAAI,CAAC,CAAC,eAAe,EAAE,CAAA;QAC9B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,aAAa,EAAE,CAAA;QAClC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,aAAa,EAAE,CAAA;QACxC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAA;QACpC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,aAAa,EAAE,CAAA;QACrC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,CAAA;QACnC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,aAAa,EAAE,CAAA;QAClC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,aAAa,EAAE,CAAA;QAC3C,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,CAAA;QACpC,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC,WAAW,EAAE,gBAAgB,EAAE,eAAe,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;QACpG,OAAO,IAAI,CAAA;IACb,CAAC;CACF,CAAC,CACH,CAAA","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport { app, assertPack, snapTarget } from \"../helpers/packTester\"\n\ntest.ifDevOrLinuxCi(\"snap\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      electronFuses: {\n        runAsNode: true,\n        enableCookieEncryption: true,\n        enableNodeOptionsEnvironmentVariable: true,\n        enableNodeCliInspectArguments: true,\n        enableEmbeddedAsarIntegrityValidation: true,\n        onlyLoadAppFromAsar: true,\n        loadBrowserProcessSpecificV8Snapshot: true,\n        grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n      },\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"arm\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.LINUX.createTarget(\"snap\", Arch.armv7l),\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"default stagePackages\", async ({ expect }) => {\n  for (const p of [[\"default\"], [\"default\", \"custom\"], [\"custom\", \"default\"], [\"foo1\", \"default\", \"foo2\"]]) {\n    await assertPack(expect, \"test-app-one\", {\n      targets: snapTarget,\n      config: {\n        extraMetadata: {\n          name: \"sep\",\n        },\n        productName: \"Sep\",\n        snap: {\n          stagePackages: p,\n          plugs: p,\n          confinement: \"classic\",\n          // otherwise \"parts\" will be removed\n          useTemplateApp: false,\n        },\n      },\n      effectiveOptionComputed: async ({ snap, args }) => {\n        delete snap.parts.app.source\n        expect(snap).toMatchSnapshot()\n        expect(args).not.toContain(\"--exclude\")\n        return true\n      },\n    })\n  }\n})\n\ntest.ifDevOrLinuxCi(\"classic confinement\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"cl-co-app\",\n      },\n      productName: \"Snap Electron App (classic confinement)\",\n      snap: {\n        confinement: \"classic\",\n      },\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"buildPackages\", async ({ expect }) => {\n  await assertPack(expect, \"test-app-one\", {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        buildPackages: [\"foo1\", \"default\", \"foo2\"],\n        // otherwise \"parts\" will be removed\n        useTemplateApp: false,\n      },\n    },\n    effectiveOptionComputed: async ({ snap }) => {\n      delete snap.parts.app.source\n      expect(snap).toMatchSnapshot()\n      return true\n    },\n  })\n})\n\ntest.ifDevOrLinuxCi(\"plugs option\", async ({ expect }) => {\n  for (const p of [\n    [\n      {\n        \"browser-sandbox\": {\n          interface: \"browser-support\",\n          \"allow-sandbox\": true,\n        },\n      },\n      \"another-simple-plug-name\",\n    ],\n    {\n      \"browser-sandbox\": {\n        interface: \"browser-support\",\n        \"allow-sandbox\": true,\n      },\n      \"another-simple-plug-name\": null,\n    },\n  ]) {\n    await assertPack(expect, \"test-app-one\", {\n      targets: snapTarget,\n      config: {\n        snap: {\n          plugs: p,\n          // otherwise \"parts\" will be removed\n          useTemplateApp: false,\n        },\n      },\n      effectiveOptionComputed: async ({ snap, args }) => {\n        delete snap.parts.app.source\n        expect(snap).toMatchSnapshot()\n        expect(args).not.toContain(\"--exclude\")\n        return true\n      },\n    })\n  }\n})\n\ntest.ifDevOrLinuxCi(\"slots option\", async ({ expect }) => {\n  for (const slots of [\n    [\"foo\", \"bar\"],\n    [\n      {\n        mpris: {\n          interface: \"mpris\",\n          name: \"chromium\",\n        },\n      },\n      \"another-simple-slot-name\",\n    ],\n  ]) {\n    await assertPack(expect, \"test-app-one\", {\n      targets: snapTarget,\n      config: {\n        extraMetadata: {\n          name: \"sep\",\n        },\n        productName: \"Sep\",\n        snap: {\n          slots,\n        },\n      },\n      effectiveOptionComputed: async ({ snap, args }) => {\n        expect(snap).toMatchSnapshot()\n        return true\n      },\n    })\n  }\n})\n\ntest.ifDevOrLinuxCi(\"custom env\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        environment: {\n          FOO: \"bar\",\n        },\n      },\n    },\n    effectiveOptionComputed: async ({ snap }) => {\n      expect(snap).toMatchSnapshot()\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"custom after, no desktop\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        after: [\"bar\"],\n      },\n    },\n    effectiveOptionComputed: async ({ snap }) => {\n      expect(snap).toMatchSnapshot()\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"no desktop plugs\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        plugs: [\"foo\", \"bar\"],\n      },\n    },\n    effectiveOptionComputed: async ({ snap, args }) => {\n      expect(snap).toMatchSnapshot()\n      expect(args).toContain(\"--exclude\")\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"auto start\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        autoStart: true,\n      },\n    },\n    effectiveOptionComputed: async ({ snap, args }) => {\n      expect(snap).toMatchSnapshot()\n      expect(snap.apps.sep.autostart).toEqual(\"sep.desktop\")\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"default compression\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n    },\n    effectiveOptionComputed: async ({ snap, args }) => {\n      expect(snap).toMatchSnapshot()\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"compression option\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      extraMetadata: {\n        name: \"sep\",\n      },\n      productName: \"Sep\",\n      snap: {\n        useTemplateApp: false,\n        compression: \"xz\",\n      },\n    },\n    effectiveOptionComputed: async ({ snap, args }) => {\n      expect(snap).toMatchSnapshot()\n      expect(snap.compression).toBe(\"xz\")\n      expect(args).toEqual(expect.arrayContaining([\"--compression\", \"xz\"]))\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"default base\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      productName: \"Sep\",\n    },\n    effectiveOptionComputed: async ({ snap }) => {\n      expect(snap).toMatchSnapshot()\n      expect(snap.base).toBe(\"core20\")\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"base option\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      productName: \"Sep\",\n      snap: {\n        base: \"core22\",\n      },\n    },\n    effectiveOptionComputed: async ({ snap }) => {\n      expect(snap).toMatchSnapshot()\n      expect(snap.base).toBe(\"core22\")\n      return true\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"use template app\", ({ expect }) =>\n  app(expect, {\n    targets: snapTarget,\n    config: {\n      snap: {\n        useTemplateApp: true,\n        compression: \"xz\",\n      },\n    },\n    effectiveOptionComputed: async ({ snap, args }) => {\n      expect(snap).toMatchSnapshot()\n      expect(snap.parts).toBeUndefined()\n      expect(snap.compression).toBeUndefined()\n      expect(snap.contact).toBeUndefined()\n      expect(snap.donation).toBeUndefined()\n      expect(snap.issues).toBeUndefined()\n      expect(snap.parts).toBeUndefined()\n      expect(snap[\"source-code\"]).toBeUndefined()\n      expect(snap.website).toBeUndefined()\n      expect(args).toEqual(expect.arrayContaining([\"--exclude\", \"chrome-sandbox\", \"--compression\", \"xz\"]))\n      return true\n    },\n  })\n)\n"]}