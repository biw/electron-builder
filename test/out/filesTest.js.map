{"version":3,"file":"filesTest.js","sourceRoot":"","sources":["../src/filesTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { TmpDir, archFromString, copyDir } from \"builder-util\"\nimport { DIR_TARGET, Platform } from \"electron-builder\"\nimport { outputFile } from \"fs-extra\"\nimport * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { Mode, RWX } from \"stat-mode\"\nimport { assertThat } from \"./helpers/fileAssert\"\nimport { app, appThrows, assertPack, checkDirContents, linuxDirTarget, modifyPackageJson } from \"./helpers/packTester\"\nimport { ExpectStatic } from \"vitest\"\n\ntest.ifDevOrLinuxCi(\"expand not defined env\", ({ expect }) =>\n  appThrows(expect, {\n    targets: linuxDirTarget,\n    config: {\n      asar: false,\n      // tslint:disable:no-invalid-template-strings\n      files: [\"${env.FOO_NOT_DEFINED}\"],\n    },\n  })\n)\n\nprocess.env.__NOT_BAR__ = \"!**/bar\"\n\ntest.ifDevOrLinuxCi(\"files\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        asar: false,\n        // tslint:disable:no-invalid-template-strings\n        files: [\"**/*\", \"!ignoreMe${/*}\", \"${env.__NOT_BAR__}\", \"dist/electron/**/*\"],\n      },\n    },\n    {\n      projectDirCreated: projectDir =>\n        Promise.all([\n          outputFile(path.join(projectDir, \"ignoreMe\", \"foo\"), \"data\"),\n          outputFile(path.join(projectDir, \"ignoreEmptyDir\", \"bar\"), \"data\"),\n          outputFile(path.join(projectDir, \"test.h\"), \"test that\"),\n          outputFile(path.join(projectDir, \"dist/electron/foo.js\"), \"data\"),\n        ]),\n      packed: context => {\n        const resources = path.join(context.getResources(Platform.LINUX), \"app\")\n        return checkDirContents(expect, resources)\n      },\n    }\n  )\n)\n\ntest.ifDevOrLinuxCi(\"files.from asar\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        asar: true,\n        files: [\n          {\n            from: \".\",\n            to: \".\",\n            filter: [\"package.json\"],\n          },\n          {\n            from: \"app/node\",\n            to: \"app/node\",\n          },\n        ],\n      },\n    },\n    {\n      projectDirCreated: projectDir =>\n        Promise.all([\n          fs.mkdir(path.join(projectDir, \"app/node\"), { recursive: true }).then(() => fs.rename(path.join(projectDir, \"index.js\"), path.join(projectDir, \"app/node/index.js\"))),\n          modifyPackageJson(projectDir, data => {\n            data.main = \"app/node/index.js\"\n          }),\n        ]),\n    }\n  )\n)\n\ntest.ifNotWindows(\"map resources\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        asar: false,\n        extraResources: [\n          {\n            from: \"foo/old\",\n            to: \"foo/new\",\n          },\n          {\n            from: \"license.txt\",\n            to: \".\",\n          },\n        ],\n      },\n    },\n    {\n      projectDirCreated: projectDir => Promise.all([outputFile(path.join(projectDir, \"foo\", \"old\"), \"data\"), outputFile(path.join(projectDir, \"license.txt\"), \"data\")]),\n      packed: context => {\n        const resources = context.getResources(Platform.LINUX)\n        return Promise.all([\n          assertThat(expect, path.join(resources, \"app\", \"foo\", \"old\")).doesNotExist(),\n          assertThat(expect, path.join(resources, \"foo\", \"new\")).isFile(),\n          assertThat(expect, path.join(resources, \"license.txt\")).isFile(),\n        ])\n      },\n    }\n  )\n)\n\nasync function doExtraResourcesTest(expect: ExpectStatic, platform: Platform) {\n  const osName = platform.buildConfigurationKey\n  await assertPack(\n    expect,\n    \"test-app-one\",\n    {\n      // to check NuGet package\n      targets: platform.createTarget(platform === Platform.WINDOWS ? \"squirrel\" : DIR_TARGET),\n      config: {\n        extraResources: [\"foo\", \"bar/hello.txt\", \"./dir-relative/f.txt\", \"bar/${arch}.txt\", \"${os}/${arch}.txt\"],\n        [osName]: {\n          extraResources: [\"platformSpecificR\"],\n          extraFiles: [\"platformSpecificF\"],\n        },\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        return Promise.all([\n          outputFile(path.resolve(projectDir, \"foo/nameWithoutDot\"), \"nameWithoutDot\"),\n          outputFile(path.resolve(projectDir, \"bar/hello.txt\"), \"data\"),\n          outputFile(path.resolve(projectDir, \"dir-relative/f.txt\"), \"data\"),\n          outputFile(path.resolve(projectDir, `bar/${process.arch}.txt`), \"data\"),\n          outputFile(path.resolve(projectDir, `${osName}/${process.arch}.txt`), \"data\"),\n          outputFile(path.resolve(projectDir, \"platformSpecificR\"), \"platformSpecificR\"),\n          outputFile(path.resolve(projectDir, \"ignoreMe.txt\"), \"ignoreMe\"),\n        ])\n      },\n      packed: async context => {\n        const resourcesDir = context.getResources(platform, archFromString(process.arch))\n        return Promise.all([\n          assertThat(expect, path.resolve(resourcesDir, \"foo\")).isDirectory(),\n          assertThat(expect, path.resolve(resourcesDir, \"foo\", \"nameWithoutDot\")).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, \"bar\", \"hello.txt\")).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, \"dir-relative\", \"f.txt\")).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, \"bar\", `${process.arch}.txt`)).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, osName, `${process.arch}.txt`)).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, \"platformSpecificR\")).isFile(),\n          assertThat(expect, path.resolve(resourcesDir, \"ignoreMe.txt\")).doesNotExist(),\n        ])\n      },\n    }\n  )\n}\n\ntest.ifDevOrLinuxCi(\"extraResources on Linux\", ({ expect }) => doExtraResourcesTest(expect, Platform.LINUX))\n\n// Squirrel.Windows is not supported on macOS anymore (32-bit)\n// Skipped due to bug in rimraf on Windows: `at fixWinEPERM (../node_modules/.pnpm/fs-extra@8.1.0/node_modules/fs-extra/lib/remove/rimraf.js:117:5)`\ntest.ifLinux(\"extraResources on Windows\", ({ expect }) => doExtraResourcesTest(expect, Platform.WINDOWS))\n\ntest.ifMac(\"extraResources on macOS\", ({ expect }) => doExtraResourcesTest(expect, Platform.MAC))\n\ntest.ifNotWindows.ifNotCiWin(\"extraResources - two-package\", ({ expect }) => {\n  const platform = Platform.LINUX\n  const osName = platform.buildConfigurationKey\n\n  //noinspection SpellCheckingInspection\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      // to check NuGet package\n      targets: platform.createTarget(DIR_TARGET),\n      config: {\n        asar: true,\n        extraResources: [\"foo\", \"bar/hello.txt\", \"bar/${arch}.txt\", \"${os}/${arch}.txt\", \"executable*\"],\n        [osName]: {\n          extraResources: [\"platformSpecificR\"],\n          extraFiles: [\"platformSpecificF\"],\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          outputFile(path.join(projectDir, \"foo/nameWithoutDot\"), \"nameWithoutDot\"),\n          outputFile(path.join(projectDir, \"bar/hello.txt\"), \"data\", { mode: 0o400 }),\n          outputFile(path.join(projectDir, `bar/${process.arch}.txt`), \"data\"),\n          outputFile(path.join(projectDir, `${osName}/${process.arch}.txt`), \"data\"),\n          outputFile(path.join(projectDir, \"platformSpecificR\"), \"platformSpecificR\"),\n          outputFile(path.join(projectDir, \"ignoreMe.txt\"), \"ignoreMe\"),\n          outputFile(path.join(projectDir, \"executable\"), \"executable\", { mode: 0o755 }),\n          outputFile(path.join(projectDir, \"executableOnlyOwner\"), \"executable\", { mode: 0o740 }),\n        ])\n      },\n      packed: async context => {\n        const resourcesDir = context.getResources(platform, archFromString(process.arch))\n        const appDir = path.join(resourcesDir, \"app\")\n\n        await Promise.all([\n          assertThat(expect, path.join(resourcesDir, \"foo\")).isDirectory(),\n          assertThat(expect, path.join(appDir, \"foo\")).doesNotExist(),\n\n          assertThat(expect, path.join(resourcesDir, \"foo\", \"nameWithoutDot\")).isFile(),\n          assertThat(expect, path.join(appDir, \"foo\", \"nameWithoutDot\")).doesNotExist(),\n\n          assertThat(expect, path.join(resourcesDir, \"bar\", \"hello.txt\")).isFile(),\n          assertThat(expect, path.join(resourcesDir, \"bar\", `${process.arch}.txt`)).isFile(),\n          assertThat(expect, path.join(appDir, \"bar\", `${process.arch}.txt`)).doesNotExist(),\n\n          assertThat(expect, path.join(resourcesDir, osName, `${process.arch}.txt`)).isFile(),\n          assertThat(expect, path.join(resourcesDir, \"platformSpecificR\")).isFile(),\n          assertThat(expect, path.join(resourcesDir, \"ignoreMe.txt\")).doesNotExist(),\n\n          allCan(path.join(resourcesDir, \"executable\"), true),\n          allCan(path.join(resourcesDir, \"executableOnlyOwner\"), true),\n\n          allCan(path.join(resourcesDir, \"bar\", \"hello.txt\"), false),\n        ])\n\n        expect(await fs.readFile(path.join(resourcesDir, \"bar\", \"hello.txt\"), \"utf-8\")).toEqual(\"data\")\n      },\n    }\n  )\n})\n\n// https://github.com/electron-userland/electron-builder/pull/998\n// copyDir walks to a symlink referencing a file that has not yet been copied by postponing the linking step until after the full walk is complete\ntest.ifNotWindows(\"postpone symlink\", async ({ expect }) => {\n  const tmpDir = new TmpDir(\"files-test\")\n  const source = await tmpDir.getTempDir()\n  const aSourceFile = path.join(source, \"z\", \"Z\")\n  const bSourceFileLink = path.join(source, \"B\")\n  await outputFile(aSourceFile, \"test\")\n  await fs.symlink(aSourceFile, bSourceFileLink)\n\n  const dest = await tmpDir.getTempDir()\n  await copyDir(source, dest)\n\n  await tmpDir.cleanup()\n})\n\nasync function allCan(file: string, execute: boolean) {\n  const mode = new Mode(await fs.stat(file))\n\n  function checkExecute(value: RWX) {\n    if (value.execute !== execute) {\n      throw new Error(`${file} is ${execute ? \"not \" : \"\"}executable`)\n    }\n  }\n\n  function checkRead(value: RWX) {\n    if (!value.read) {\n      throw new Error(`${file} is not readable`)\n    }\n  }\n\n  checkExecute(mode.owner)\n  checkExecute(mode.group)\n  checkExecute(mode.others)\n\n  checkRead(mode.owner)\n  checkRead(mode.group)\n  checkRead(mode.others)\n}\n"]}