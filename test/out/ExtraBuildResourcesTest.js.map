{"version":3,"file":"ExtraBuildResourcesTest.js","sourceRoot":"","sources":["../src/ExtraBuildResourcesTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, build, PackagerOptions, Platform } from \"electron-builder\"\nimport * as fs from \"fs\"\nimport * as path from \"path\"\nimport { assertThat } from \"./helpers/fileAssert\"\nimport { app, assertPack, linuxDirTarget, modifyPackageJson } from \"./helpers/packTester\"\nimport { ELECTRON_VERSION, getElectronCacheDir } from \"./helpers/testConfig\"\nimport { expectUpdateMetadata } from \"./helpers/winHelper\"\nimport { ExpectStatic } from \"vitest\"\nimport * as unzipper from \"unzipper\"\nimport { TmpDir } from \"temp-file\"\nimport { readdir } from \"fs/promises\"\n\nfunction createBuildResourcesTest(expect: ExpectStatic, packagerOptions: PackagerOptions) {\n  return app(\n    expect,\n    {\n      ...packagerOptions,\n      config: {\n        publish: null,\n        directories: {\n          buildResources: \"custom\",\n          // tslint:disable:no-invalid-template-strings\n          output: \"customDist/${channel}\",\n          // https://github.com/electron-userland/electron-builder/issues/601\n          app: \".\",\n        },\n        win: {\n          signAndEditExecutable: false,\n        },\n        nsis: {\n          differentialPackage: false,\n        },\n      },\n    },\n    {\n      packed: async context => {\n        await assertThat(expect, path.join(context.projectDir, \"customDist\", \"latest\")).isDirectory()\n      },\n      projectDirCreated: projectDir => Promise.resolve(fs.renameSync(path.join(projectDir, \"build\"), path.join(projectDir, \"custom\"))),\n    }\n  )\n}\n\ntest.ifNotWindows(\"custom buildResources and output dirs: mac\", ({ expect }) => createBuildResourcesTest(expect, { mac: [\"dir\"] }))\ntest.ifNotCiMac(\"custom buildResources and output dirs: win\", ({ expect }) => createBuildResourcesTest(expect, { win: [\"nsis\"] }))\ntest.ifNotWindows(\"custom buildResources and output dirs: linux\", ({ expect }) => createBuildResourcesTest(expect, { linux: [\"appimage\"] }))\n\ntest.ifLinuxOrDevMac(\"prepackaged\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      packed: async context => {\n        await build({\n          prepackaged: path.join(context.outDir, \"linux-unpacked\"),\n          projectDir: context.projectDir,\n          linux: [],\n          config: {\n            // test target\n            linux: {\n              target: {\n                target: \"deb\",\n                arch: \"ia32\",\n              },\n            },\n            compression: \"store\",\n          },\n        })\n        await assertThat(expect, path.join(context.projectDir, \"dist\", \"TestApp_1.1.0_i386.deb\")).isFile()\n      },\n    }\n  )\n)\n\ntest.ifLinuxOrDevMac(\"retrieve latest electron version\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.devDependencies = {\n            ...data.devDependencies,\n            electron: \"latest\",\n          }\n          delete data.build.electronVersion\n        }),\n    }\n  )\n)\n\ntest.ifLinuxOrDevMac(\"retrieve latest electron-nightly version\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.devDependencies = {\n            ...data.devDependencies,\n            \"electron-nightly\": \"latest\",\n          }\n          delete data.build.electronVersion\n        }),\n    }\n  )\n)\n\ntest.ifNotWindows(\"override targets in the config\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n    },\n    {\n      packed: async context => {\n        await build({\n          projectDir: context.projectDir,\n          linux: [\"deb\"],\n          config: {\n            publish: null,\n            // https://github.com/electron-userland/electron-builder/issues/1355\n            linux: {\n              target: [\"AppImage\", \"deb\", \"rpm\", \"pacman\"],\n            },\n            compression: \"store\",\n          },\n        })\n      },\n    }\n  )\n)\n\n// test https://github.com/electron-userland/electron-builder/issues/1182 also\ntest.ifDevOrWinCi(\"override targets in the config - only arch\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget(null, Arch.ia32),\n      config: {\n        extraMetadata: {\n          version: \"1.0.0-beta.1\",\n        },\n        // https://github.com/electron-userland/electron-builder/issues/1348\n        win: {\n          // tslint:disable:no-invalid-template-strings\n          artifactName: \"${channel}-${name}.exe\",\n          target: [\"nsis\"],\n        },\n        publish: {\n          provider: \"generic\",\n          url: \"https://develar.s3.amazonaws.com/test\",\n        },\n      },\n    },\n    {\n      packed: context => {\n        return Promise.all([\n          assertThat(expect, path.join(context.projectDir, \"dist\", \"win-unpacked\")).doesNotExist(),\n          assertThat(expect, path.join(context.projectDir, \"dist\", \"latest.yml\")).doesNotExist(),\n          expectUpdateMetadata(expect, context, Arch.ia32),\n        ])\n      },\n    }\n  )\n)\n\n// test on all CI to check path separators\ntest(\"do not exclude build entirely (respect files)\", ({ expect }) => assertPack(expect, \"test-app-build-sub\", { targets: linuxDirTarget }))\n\ntest.ifNotWindows(\"electronDist as path to local folder with electron builds zipped \", ({ expect }) =>\n  app(expect, {\n    targets: linuxDirTarget,\n    config: {\n      electronDist: getElectronCacheDir(),\n    },\n  })\n)\n\ntest.ifNotWindows(\"electronDist as callback function for path to local folder with electron builds zipped \", ({ expect }) =>\n  app(expect, {\n    targets: linuxDirTarget,\n    config: {\n      electronDist: _context => {\n        return Promise.resolve(getElectronCacheDir())\n      },\n    },\n  })\n)\n\ntest.ifLinux(\"electronDist as standard path to node_modules electron\", ({ expect }) => {\n  return app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        electronDist: \"node_modules/electron/dist\",\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await modifyPackageJson(projectDir, data => {\n          data.devDependencies = {\n            ...data.devDependencies,\n            electron: ELECTRON_VERSION,\n          }\n          delete data.build.electronVersion\n        })\n      },\n      packed: async context => {\n        const contents = await readdir(context.getAppPath(Platform.LINUX, Arch.x64))\n        expect(contents).toMatchSnapshot()\n      },\n    }\n  )\n})\n\ntest.ifNotWindows(\"electronDist as callback function for path to locally unzipped\", ({ expect }) => {\n  const tmpDir = new TmpDir()\n\n  return app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        electronDist: async context => {\n          const { platformName, arch, version } = context\n          const fileName = `electron-v${version}-${platformName}-${arch}.zip`\n          const electronUrl = `https://github.com/electron/electron/releases/download/v${version}/${fileName}`\n\n          const tempDir = await tmpDir.getTempDir()\n          if (!fs.existsSync(tempDir)) {\n            fs.mkdirSync(tempDir)\n          }\n          const electronPath = path.join(tempDir, \"electron-dist\")\n\n          const directory = await unzipper.Open.url(require(\"request\"), electronUrl)\n          await directory.extract({ path: electronPath, concurrency: 5, forceStream: true })\n\n          return electronPath\n        },\n      },\n    },\n    {\n      packed: async context => {\n        const contents = await readdir(context.getAppPath(Platform.LINUX, Arch.x64))\n        expect(contents).toMatchSnapshot()\n        await tmpDir.cleanup()\n      },\n    }\n  )\n})\n\nconst overridePublishChannel: any = {\n  channel: \"beta\",\n}\n\ntest.ifDevOrLinuxCi(\"overriding the publish channel\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        publish: overridePublishChannel,\n      },\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.devDependencies = {}\n          data.build.publish = [\n            {\n              provider: \"s3\",\n              bucket: \"my-s3-bucket\",\n            },\n          ]\n        }),\n      packed: async context => {\n        expect(context.packager.config.publish).toMatchSnapshot()\n        return Promise.resolve()\n      },\n    }\n  )\n)\n"]}