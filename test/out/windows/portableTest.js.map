{"version":3,"file":"portableTest.js","sourceRoot":"","sources":["../../src/windows/portableTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport * as path from \"path\"\nimport { app, copyTestAsset, getFixtureDir } from \"../helpers/packTester\"\n\n// build in parallel - https://github.com/electron-userland/electron-builder/issues/1340#issuecomment-286061789\ntest.ifNotCiMac(\"portable\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget([\"portable\", \"nsis\"]),\n    config: {\n      publish: null,\n      nsis: {\n        differentialPackage: false,\n      },\n      electronFuses: {\n        runAsNode: true,\n        enableCookieEncryption: true,\n        enableNodeOptionsEnvironmentVariable: true,\n        enableNodeCliInspectArguments: true,\n        enableEmbeddedAsarIntegrityValidation: true,\n        onlyLoadAppFromAsar: true,\n        loadBrowserProcessSpecificV8Snapshot: true,\n        grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n      },\n    },\n  })\n)\n\ntest.ifDevOrWinCi(\"portable zip\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget(\"portable\"),\n    config: {\n      publish: null,\n      portable: {\n        useZip: true,\n        unpackDirName: \"0ujssxh0cECutqzMgbtXSGnjorm\",\n      },\n      compression: \"normal\",\n    },\n  })\n)\n\ntest.ifNotCi(\"portable zip several archs\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget(\"portable\", Arch.ia32, Arch.x64),\n    config: {\n      publish: null,\n      portable: {\n        useZip: true,\n        unpackDirName: false,\n      },\n      compression: \"store\",\n    },\n  })\n)\n\ntest.ifNotCiMac(\"portable - artifactName and request execution level\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: Platform.WINDOWS.createTarget([\"portable\"]),\n      config: {\n        nsis: {\n          //tslint:disable-next-line:no-invalid-template-strings\n          artifactName: \"${productName}Installer.${version}.${ext}\",\n          installerIcon: \"foo test space.ico\",\n        },\n        portable: {\n          unpackDirName: true,\n          requestExecutionLevel: \"admin\",\n          //tslint:disable-next-line:no-invalid-template-strings\n          artifactName: \"${productName}Portable.${version}.${ext}\",\n        },\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return copyTestAsset(\"headerIcon.ico\", path.join(projectDir, \"build\", \"foo test space.ico\"))\n      },\n    }\n  )\n)\n\ntest.ifDevOrWinCi(\"portable - splashImage\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.WINDOWS.createTarget([\"portable\"]),\n    config: {\n      publish: null,\n      portable: {\n        //tslint:disable-next-line:no-invalid-template-strings\n        artifactName: \"${productName}Portable.${version}.${ext}\",\n        splashImage: path.resolve(getFixtureDir(), \"installerHeader.bmp\"),\n      },\n    },\n  })\n)\n"]}