{"version":3,"file":"GitlabTestFixtures.js","sourceRoot":"","sources":["../../../src/publisher/gitlab/GitlabTestFixtures.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\"\nimport { GitlabOptions } from \"builder-util-runtime\"\n\nexport class GitlabTestFixtures {\n  // Test file paths\n  static readonly ICON_PATH = path.join(__dirname, \"..\", \"..\", \"..\", \"fixtures\", \"test-app\", \"build\", \"icon.icns\")\n  static readonly ICO_PATH = path.join(__dirname, \"..\", \"..\", \"..\", \"fixtures\", \"test-app\", \"build\", \"icon.ico\")\n\n  // Test versions\n  static readonly VERSIONS = {\n    valid: \"1.0.0\",\n    validWithBuild: \"1.0.0-beta.1\",\n    invalidWithV: \"v1.0.0\",\n    randomVersion: () => GitlabTestFixtures.generateRandomVersion(),\n  } as const\n\n  // Project configurations\n  static readonly PROJECTS = {\n    valid: \"72170733\",\n    nonExistent: \"99999999\",\n    stringFormat: \"namespace/project-name\",\n    numericFormat: 12345678,\n  } as const\n\n  // Host configurations\n  static readonly HOSTS = {\n    gitlab: \"gitlab.com\",\n    custom: \"gitlab.example.com\",\n    enterprise: \"git.company.com\",\n  } as const\n\n  // Token configurations\n  static readonly TOKENS = {\n    test: \"__test__\",\n    invalid: \"invalid-token\",\n    malformed: \"glpat-invalid!@#$%\",\n  } as const\n\n  // Error patterns for assertions\n  static readonly ERROR_PATTERNS = {\n    auth: /(Unauthorized|401|invalid token|Bad credentials|403|Forbidden)/i,\n    notFound: /(404|not found|doesn't exist)/i,\n    rateLimit: /rate limit exceeded/i,\n    missingToken: /GitLab Personal Access Token is not set/i,\n    missingProject: /GitLab project ID or path is not specified/i,\n    invalidVersion: /Version must not start with \"v\"/i,\n  } as const\n\n  // Default configurations\n  static readonly DEFAULT_OPTIONS: GitlabOptions = {\n    provider: \"gitlab\",\n    projectId: GitlabTestFixtures.PROJECTS.valid,\n    host: GitlabTestFixtures.HOSTS.gitlab,\n    token: GitlabTestFixtures.TOKENS.test,\n  }\n\n  static readonly DEFAULT_PUBLISH_OPTIONS = {\n    publish: \"always\" as const,\n  }\n\n  // Helper methods\n  static generateRandomVersion(): string {\n    const randomInt = (min: number, max: number) => Math.floor(Math.random() * (max - min + 1)) + min\n    return `${randomInt(0, 99)}.${randomInt(0, 99)}.${randomInt(0, 99)}`\n  }\n\n  static createOptions(overrides: Partial<GitlabOptions> = {}): GitlabOptions {\n    return { ...GitlabTestFixtures.DEFAULT_OPTIONS, ...overrides }\n  }\n\n  static createTestFiles(): { name: string; path: string }[] {\n    return [\n      { name: \"icon.icns\", path: GitlabTestFixtures.ICON_PATH },\n      { name: \"icon.ico\", path: GitlabTestFixtures.ICO_PATH },\n    ]\n  }\n\n  // Environment setup helpers\n  static setupTestEnvironment(): {\n    original: Record<string, string | undefined>\n    restore: () => void\n  } {\n    const original = {\n      GITLAB_TOKEN: process.env.GITLAB_TOKEN,\n      CI_PROJECT_ID: process.env.CI_PROJECT_ID,\n      CI_PROJECT_PATH: process.env.CI_PROJECT_PATH,\n    }\n\n    return {\n      original,\n      restore: () => {\n        Object.entries(original).forEach(([key, value]) => {\n          if (value !== undefined) {\n            process.env[key] = value\n          } else {\n            delete process.env[key]\n          }\n        })\n      },\n    }\n  }\n\n  // Assertion helpers for test validation\n  static validateReleaseStructure(release: unknown): boolean {\n    const r = release as any\n    return typeof r?.tag_name === \"string\" && typeof r?.name === \"string\" && Array.isArray(r?.assets?.links)\n  }\n\n  static validateAssetLinkStructure(link: unknown, assetType: \"project_upload\" | \"generic_package\"): boolean {\n    const l = link as any\n\n    // GitLab upload URL pattern: https://gitlab.com/-/project/{projectId}/uploads/{hash}/{filename}\n    const gitlabUploadUrlPattern = /^https:\\/\\/gitlab\\.com\\/-\\/project\\/\\d+\\/uploads\\/[a-f0-9]{32}\\/.+$/\n\n    // GitLab generic package URL pattern: https://gitlab.com/api/v4/projects/{projectId}/packages/generic/{packageName}/{packageVersion}/{filename}\n    const gitlabGenericPackageUrlPattern = /^https:\\/\\/gitlab\\.com\\/api\\/v4\\/projects\\/\\d+\\/packages\\/generic\\/.+\\/.+\\/.+$/\n\n    const isValidUrl = (url: string) => {\n      if (assetType === \"project_upload\") {\n        return gitlabUploadUrlPattern.test(url)\n      } else if (assetType === \"generic_package\") {\n        return gitlabGenericPackageUrlPattern.test(url)\n      }\n      return false\n    }\n\n    return (\n      (typeof l?.id === \"string\" || typeof l?.id === \"number\") &&\n      typeof l?.name === \"string\" &&\n      typeof l?.url === \"string\" &&\n      isValidUrl(l?.url) &&\n      typeof l?.direct_asset_url === \"string\" &&\n      isValidUrl(l?.direct_asset_url) &&\n      typeof l?.link_type === \"string\"\n    )\n  }\n}\n"]}