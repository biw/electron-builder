{"version":3,"file":"extraMetadataTest.js","sourceRoot":"","sources":["../src/extraMetadataTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { readAsarJson } from \"app-builder-lib/out/asar/asar\"\nimport { Platform } from \"electron-builder\"\nimport { coerceTypes } from \"electron-builder/out/builder\"\nimport { readJson } from \"fs-extra\"\nimport * as path from \"path\"\nimport { assertThat } from \"./helpers/fileAssert\"\nimport { app, linuxDirTarget, modifyPackageJson } from \"./helpers/packTester\"\nimport { ExpectStatic } from \"vitest\"\n\nfunction createExtraMetadataTest(expect: ExpectStatic, asar: boolean) {\n  return app(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: coerceTypes({\n        asar,\n        linux: {\n          executableName: \"new-name\",\n        },\n        extraMetadata: {\n          version: \"1.0.0-beta.19\",\n          foo: {\n            bar: 12,\n            updated: \"true\",\n            disabled: \"false\",\n          },\n          rootKey: \"false\",\n          rootKeyT: \"true\",\n          rootKeyN: \"null\",\n        },\n      }),\n    },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.scripts = {}\n          data.foo = {\n            bar: 42,\n            existingProp: 22,\n          }\n        }),\n      packed: async context => {\n        await assertThat(expect, path.join(context.getContent(Platform.LINUX), \"new-name\")).isFile()\n        if (asar) {\n          expect(await readAsarJson(path.join(context.getResources(Platform.LINUX), \"app.asar\"), \"package.json\")).toMatchSnapshot()\n        } else {\n          expect(await readJson(path.join(context.getResources(Platform.LINUX), \"app\", \"package.json\"))).toMatchSnapshot()\n        }\n      },\n    }\n  )\n}\n\ntest(\"extra metadata\", ({ expect }) => createExtraMetadataTest(expect, true))\ntest(\"extra metadata (no asar)\", ({ expect }) => createExtraMetadataTest(expect, false))\n\ntest(\"cli\", ({ expect }) => {\n  // because these methods are internal\n  const { configureBuildCommand, normalizeOptions } = require(\"electron-builder/out/builder\")\n  const yargs = require(\"yargs\")\n    .strict()\n    .fail((message: string, error: Error | null) => {\n      throw error || new Error(message)\n    })\n  configureBuildCommand(yargs)\n\n  function parse(input: string): any {\n    return normalizeOptions(yargs.parse(input.split(\" \")))\n  }\n\n  function parseExtraMetadata(input: string) {\n    const result = parse(input)\n    delete result.targets\n    return result\n  }\n\n  expect(parseExtraMetadata(\"--c.extraMetadata.foo=bar\")).toMatchSnapshot()\n  expect(parseExtraMetadata(\"--c.extraMetadata.dev.login-url\")).toMatchSnapshot()\n})\n"]}