{"version":3,"file":"configurationValidationTest.js","sourceRoot":"","sources":["../src/configurationValidationTest.ts"],"names":[],"mappings":";;AAAA,mEAA8E;AAC9E,+CAAgD;AAChD,uDAA0D;AAC1D,0DAA+G;AAC/G,qDAAqE;AAErE,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAC/C,IAAA,sBAAS,EACP,MAAM,EACN;IACE,OAAO,EAAE,2BAAc;IACvB,MAAM,EAAE;QACN,GAAG,EAAE,GAAG;QACR,GAAG,EAAE;YACH,GAAG,EAAE,KAAK;SACX;KACK;CACT,EACD,SAAS,EACT,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,6CAA6C,CAAC,CAC/E,CACF,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,iBAAiB,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CACpD,IAAA,sBAAS,EAAC,MAAM,EAAE;IAChB,OAAO,EAAE,2BAAc;IACvB,MAAM,EAAE;QACN,KAAK,EAAE,EAAE;KACH;CACT,CAAC,CACH,CAAA;AAED,oEAAoE;AACpE,IAAI,CAAC,cAAc,CAAC,YAAY,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAC/C,IAAA,gBAAG,EAAC,MAAM,EAAE;IACV,OAAO,EAAE,2BAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,EAAE,mBAAI,CAAC,GAAG,CAAC;IAC1D,MAAM,EAAE;QACN,KAAK,EAAE;YACL,MAAM,EAAE,UAAU;SACnB;QACD,UAAU,EAAE;YACV,WAAW;YACX,mBAAmB;YACnB;gBACE,IAAI,EAAE,MAAM;gBACZ,EAAE,EAAE,GAAG;gBACP,MAAM,EAAE,CAAC,OAAO,CAAC;aAClB;YACD;gBACE,IAAI,EAAE,MAAM;gBACZ,EAAE,EAAE,GAAG;gBACP,MAAM,EAAE,CAAC,OAAO,CAAC;aAClB;YACD,wBAAwB;YACxB;gBACE,IAAI,EAAE,UAAU;gBAChB,EAAE,EAAE,GAAG;aACR;SACF;KACF;CACF,CAAC,CACH,CAAA;AAED,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE;IAC1C,OAAO,IAAA,8BAAqB,EAC1B;QACE,KAAK,EAAE,mBAAmB;QAC1B,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC;QACxD,GAAG,EAAE;YACH,MAAM,EAAE,MAAM;YACd,IAAI,EAAE,gBAAgB;SACvB;KACF,EACD,IAAI,0BAAW,EAAE,CAClB,CAAA;AACH,CAAC,CAAC,CAAA;AAEF,IAAI,CAAC,cAAc,CAAC,qBAAqB,EAAE,KAAK,EAAE,EAAE,MAAM,EAAE,EAAE,EAAE;IAC9D,MAAM,KAAK,GAAG,IAAA,+BAAqB,EAAC,IAAA,qBAAW,GAAE,CAAC,CAAA;IAClD,MAAM,OAAO,GAAG,IAAA,0BAAgB,EAAC,KAAK,CAAC,KAAK,CAAC,CAAC,sBAAsB,EAAE,oCAAoC,CAAC,CAAe,CAAC,CAAA;IAC3H,MAAM,MAAM,GAAG,OAAO,CAAC,MAAuB,CAAA;IAC9C,MAAM,IAAA,8BAAqB,EAAC,MAAM,EAAE,IAAI,0BAAW,EAAE,CAAC,CAAA;IACtD,MAAM,CAAC,MAAM,CAAC,GAAI,CAAC,QAAQ,CAAC,CAAC,QAAQ,EAAE,CAAA;IACvC,MAAM,CAAC,MAAM,CAAC,GAAI,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;AACjD,CAAC,CAAC,CAAA","sourcesContent":["import { validateConfiguration } from \"app-builder-lib/out/util/config/config\"\nimport { Arch, DebugLogger } from \"builder-util\"\nimport { Configuration, Platform } from \"electron-builder\"\nimport { CliOptions, configureBuildCommand, createYargs, normalizeOptions } from \"electron-builder/out/builder\"\nimport { app, appThrows, linuxDirTarget } from \"./helpers/packTester\"\n\ntest.ifDevOrLinuxCi(\"validation\", ({ expect }) =>\n  appThrows(\n    expect,\n    {\n      targets: linuxDirTarget,\n      config: {\n        foo: 123,\n        mac: {\n          foo: 12123,\n        },\n      } as any,\n    },\n    undefined,\n    error => error.message.includes(\"configuration has an unknown property 'foo'\")\n  )\n)\n\ntest.ifDevOrLinuxCi(\"appId as object\", ({ expect }) =>\n  appThrows(expect, {\n    targets: linuxDirTarget,\n    config: {\n      appId: {},\n    } as any,\n  })\n)\n\n// https://github.com/electron-userland/electron-builder/issues/1302\ntest.ifDevOrLinuxCi(\"extraFiles\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.LINUX.createTarget(\"appimage\", Arch.x64),\n    config: {\n      linux: {\n        target: \"zip:ia32\",\n      },\n      extraFiles: [\n        \"lib/*.jar\",\n        \"lib/Proguard/**/*\",\n        {\n          from: \"lib/\",\n          to: \".\",\n          filter: [\"*.dll\"],\n        },\n        {\n          from: \"lib/\",\n          to: \".\",\n          filter: [\"*.exe\"],\n        },\n        \"BLClient/BLClient.json\",\n        {\n          from: \"include/\",\n          to: \".\",\n        },\n      ],\n    },\n  })\n)\n\ntest.ifDevOrLinuxCi(\"files\", ({ expect }) => {\n  return validateConfiguration(\n    {\n      appId: \"com.example.myapp\",\n      files: [{ from: \"dist/app\", to: \"app\", filter: \"*.js\" }],\n      win: {\n        target: \"NSIS\",\n        icon: \"build/icon.ico\",\n      },\n    },\n    new DebugLogger()\n  )\n})\n\ntest.ifDevOrLinuxCi(\"null string as null\", async ({ expect }) => {\n  const yargs = configureBuildCommand(createYargs())\n  const options = normalizeOptions(yargs.parse([\"-c.mac.identity=null\", \"--config.mac.hardenedRuntime=false\"]) as CliOptions)\n  const config = options.config as Configuration\n  await validateConfiguration(config, new DebugLogger())\n  expect(config.mac!.identity).toBeNull()\n  expect(config.mac!.hardenedRuntime).toBe(false)\n})\n"]}