{"version":3,"file":"rebuilderTest.js","sourceRoot":"","sources":["../src/rebuilderTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Configuration, Platform } from \"app-builder-lib\"\nimport { PM } from \"app-builder-lib/out/node-module-collector\"\nimport { exists } from \"builder-util/src/util\"\nimport path from \"path\"\nimport { assertPack, linuxDirTarget, modifyPackageJson } from \"./helpers/packTester\"\nimport { ELECTRON_VERSION } from \"./helpers/testConfig\"\nimport { verifySmartUnpack } from \"./helpers/verifySmartUnpack\"\n\nconst packageConfig = (data: any) => {\n  data.name = \"@packageManagers/test-app-yarn-workspace\"\n  data.version = \"1.0.0\"\n  data.dependencies = {\n    ...data.debpendencies,\n    debug: \"4.4.3\",\n    \"better-sqlite3-multiple-ciphers\": \"12.2.0\",\n  }\n  data.devDependencies = {\n    electron: ELECTRON_VERSION,\n  }\n  data.optionalDependencies = {}\n  return data\n}\n\nconst extraFile = \"./node_modules/better-sqlite3-multiple-ciphers/build/Release/better_sqlite3.node\"\nconst config: Configuration = {\n  npmRebuild: true,\n  asarUnpack: [\"**/better_sqlite3.node\"],\n}\n\ntest(\"yarn workspace\", ({ expect }) =>\n  assertPack(\n    expect,\n    \"test-app-yarn-workspace\",\n    {\n      targets: linuxDirTarget,\n      projectDir: \"packages/test-app\",\n      config,\n    },\n    {\n      packageManager: PM.YARN,\n      storeDepsLockfileSnapshot: true,\n      packed: async context => {\n        await verifySmartUnpack(expect, context.getResources(Platform.LINUX))\n        expect(await exists(path.join(context.getResources(Platform.LINUX), \"app.asar.unpacked\", extraFile))).toBeTruthy()\n      },\n      projectDirCreated: async projectDir => {\n        await modifyPackageJson(path.join(projectDir, \"packages\", \"test-app\"), data => packageConfig(data))\n      },\n    }\n  ))\n\n// yarn berry workspace\ntest(\"yarn berry workspace\", ({ expect }) =>\n  assertPack(\n    expect,\n    \"test-app-yarn-workspace\",\n    {\n      targets: linuxDirTarget,\n      projectDir: \"packages/test-app\",\n      config,\n    },\n    {\n      packageManager: PM.YARN_BERRY,\n      storeDepsLockfileSnapshot: true,\n      packed: async context => {\n        await verifySmartUnpack(expect, context.getResources(Platform.LINUX))\n        expect(await exists(path.join(context.getResources(Platform.LINUX), \"app.asar.unpacked\", extraFile))).toBeTruthy()\n      },\n      projectDirCreated: async projectDir => {\n        await modifyPackageJson(path.join(projectDir, \"packages\", \"test-app\"), data => packageConfig(data))\n      },\n    }\n  ))\n"]}