{"version":3,"file":"msiTest.js","sourceRoot":"","sources":["../../src/windows/msiTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from \"electron-builder\"\nimport * as fs from \"fs\"\nimport { app } from \"../helpers/packTester\"\n\ndescribe(\"msi\", { sequential: true }, () => {\n  test.ifDevOrWinCi(\"msi\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"msi\"),\n        config: {\n          appId: \"build.electron.test.msi.oneClick.perMachine\",\n          extraMetadata: {\n            // version: \"1.0.0\",\n          },\n          productName: \"Test MSI\",\n          electronFuses: {\n            runAsNode: true,\n            enableCookieEncryption: true,\n            enableNodeOptionsEnvironmentVariable: true,\n            enableNodeCliInspectArguments: true,\n            enableEmbeddedAsarIntegrityValidation: true,\n            onlyLoadAppFromAsar: true,\n            loadBrowserProcessSpecificV8Snapshot: true,\n            grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n          },\n        },\n      },\n      {\n        // signed: true,\n      }\n    )\n  )\n\n  test.ifDevOrWinCi(\"msi no asar\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"msi\"),\n        config: {\n          appId: \"build.electron.test.msi.oneClick.perMachine\",\n          extraMetadata: {\n            // version: \"1.0.0\",\n          },\n          productName: \"Test MSI\",\n          asar: false,\n        },\n      },\n      {\n        // signed: true,\n      }\n    )\n  )\n\n  test.ifDevOrWinCi(\"per-user\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"msi\"),\n        config: {\n          appId: \"build.electron.test.msi.oneClick.perUser\",\n          extraMetadata: {\n            // version: \"1.0.0\",\n          },\n          productName: \"Test MSI Per User\",\n          msi: {\n            perMachine: false,\n          },\n        },\n      },\n      {\n        // signed: true,\n      }\n    )\n  )\n\n  const wixArgsProductName = \"Test WiX Args\"\n  test.ifDevOrWinCi(\"wix args\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: Platform.WINDOWS.createTarget(\"msi\"),\n        config: {\n          appId: \"build.electron.test.msi.oneClick.wixArgs\",\n          extraMetadata: {\n            // version: \"1.0.0\",\n          },\n          productName: wixArgsProductName,\n          // Inject a custom-action which requires the WixUtilExtension DLL\n          msiProjectCreated: async path => {\n            await fs.promises.writeFile(\n              path,\n              (await fs.promises.readFile(path, \"utf8\")).replace(\n                \"</Product>\",\n                `<util:CloseApplication xmlns:util=\"http://wixtoolset.org/schemas/v4/wxs/util\"\n              PromptToContinue=\"no\"\n              Target=\"${wixArgsProductName}.exe\"\n              CloseMessage=\"yes\"\n              Timeout=\"2\"\n              TerminateProcess=\"1\"\n              RebootPrompt=\"no\"\n            />\n            </Product>`\n              )\n            )\n          },\n          msi: {\n            // Apply the needed DLL\n            additionalWixArgs: [\"-ext\", \"WixUtilExtension\"],\n          },\n        },\n      },\n      {\n        // signed: true,\n      }\n    )\n  )\n\n  test.skip(\"assisted\", ({ expect }) =>\n    app(expect, {\n      targets: Platform.WINDOWS.createTarget(\"msi\"),\n      config: {\n        appId: \"build.electron.test.msi.assisted\",\n        extraMetadata: {\n          // version: \"1.0.0\",\n        },\n        productName: \"Test MSI Assisted\",\n        // test lzx (currently, doesn't work on wine)\n        compression: \"maximum\",\n        msi: {\n          oneClick: false,\n          menuCategory: \"TestMenuDirectory\",\n        },\n      },\n    }))\n})\n"]}