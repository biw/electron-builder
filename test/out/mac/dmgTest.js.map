{"version":3,"file":"dmgTest.js","sourceRoot":"","sources":["../../src/mac/dmgTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { PlatformPackager } from \"app-builder-lib\"\nimport { Arch, copyFile, exec } from \"builder-util\"\nimport { Platform } from \"electron-builder\"\nimport * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { assertThat } from \"../helpers/fileAssert\"\nimport { app, assertPack, copyTestAsset } from \"../helpers/packTester\"\nimport { attachAndExecute, getDmgTemplatePath } from \"dmg-builder/out/dmgUtil\"\n\nconst dmgTarget = Platform.MAC.createTarget(\"dmg\", Arch.x64)\nconst defaultTarget = Platform.MAC.createTarget(undefined, Arch.x64)\n\ndescribe(\"dmg\", { concurrent: true }, () => {\n  test.ifMac(\"dmg\", ({ expect }) =>\n    app(expect, {\n      targets: dmgTarget,\n      config: {\n        productName: \"Default-Dmg\",\n        publish: null,\n      },\n    })\n  )\n\n  test.ifMac(\"no build directory\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: dmgTarget,\n        config: {\n          // dmg can mount only one volume name, so, to test in parallel, we set different product name\n          productName: \"NoBuildDirectory\",\n          publish: null,\n          dmg: {\n            title: \"Foo\",\n          },\n        },\n        effectiveOptionComputed: async it => {\n          if (!(\"volumePath\" in it)) {\n            return false\n          }\n\n          const volumePath = it.volumePath\n          await assertThat(expect, path.join(volumePath, \".background.tiff\")).isFile()\n          await assertThat(expect, path.join(volumePath, \"Applications\")).isSymbolicLink()\n          expect(\n            it.specification.contents.map((c: any) => ({\n              ...c,\n              path: path.extname(c.path) === \".app\" ? path.basename(c.path) : c.path,\n            }))\n          ).toMatchSnapshot()\n          return false\n        },\n      },\n      {\n        projectDirCreated: projectDir => fs.rm(path.join(projectDir, \"build\"), { recursive: true, force: true }),\n      }\n    )\n  )\n\n  test.ifMac(\"background color\", ({ expect }) =>\n    app(expect, {\n      targets: dmgTarget,\n      config: {\n        // dmg can mount only one volume name, so, to test in parallel, we set different product name\n        productName: \"BackgroundColor\",\n        publish: null,\n        dmg: {\n          backgroundColor: \"orange\",\n          // speed-up test\n          writeUpdateInfo: false,\n          title: \"Bar\",\n        },\n      },\n      effectiveOptionComputed: async it => {\n        if (!(\"volumePath\" in it)) {\n          return false\n        }\n        delete it.specification.icon\n        expect(it.specification).toMatchSnapshot()\n        return Promise.resolve(false)\n      },\n    })\n  )\n\n  test.ifMac(\"custom background - new way\", ({ expect }) => {\n    const customBackground = \"customBackground.png\"\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      {\n        targets: defaultTarget,\n        config: {\n          productName: \"CustomBackground\",\n          publish: null,\n          mac: {\n            icon: \"customIcon\",\n          },\n          dmg: {\n            background: customBackground,\n            icon: \"foo.icns\",\n            // speed-up test\n            writeUpdateInfo: false,\n            title: \"Custom Background\",\n          },\n        },\n        effectiveOptionComputed: async it => {\n          expect(it.specification.background).toMatch(new RegExp(`.+${customBackground}$`))\n          expect(it.specification.icon).toEqual(\"foo.icns\")\n          const packager: PlatformPackager<any> = it.packager\n          expect(await packager.getIconPath()).toEqual(path.join(packager.projectDir, \"build\", \"customIcon.icns\"))\n\n          if (!(\"volumePath\" in it)) {\n            return false\n          }\n          await assertThat(expect, path.join(it.volumePath, \".VolumeIcon.icns\")).isFile()\n          return Promise.resolve(true)\n        },\n      },\n      {\n        projectDirCreated: projectDir =>\n          Promise.all([\n            copyFile(path.join(getDmgTemplatePath(), \"background.tiff\"), path.join(projectDir, customBackground)),\n            // copy, but not rename to test that default icon is not used\n            copyFile(path.join(projectDir, \"build\", \"icon.icns\"), path.join(projectDir, \"build\", \"customIcon.icns\")),\n            copyFile(path.join(projectDir, \"build\", \"icon.icns\"), path.join(projectDir, \"foo.icns\")),\n          ]),\n      }\n    )\n  })\n\n  test.ifMac(\"retina background as 2 png\", ({ expect }) => {\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      {\n        targets: defaultTarget,\n        config: {\n          productName: \"RetinaBackground\",\n          publish: null,\n          dmg: {\n            title: \"Retina Background\",\n          },\n        },\n        effectiveOptionComputed: async it => {\n          expect(it.specification.background).toMatch(/\\.tiff$/)\n          return Promise.resolve(true)\n        },\n      },\n      {\n        projectDirCreated: async projectDir => {\n          const resourceDir = path.join(projectDir, \"build\")\n          await copyFile(path.join(getDmgTemplatePath(), \"background.tiff\"), path.join(resourceDir, \"background.tiff\"))\n\n          async function extractPng(index: number, suffix: string) {\n            await exec(\"tiffutil\", [\"-extract\", index.toString(), path.join(getDmgTemplatePath(), \"background.tiff\")], {\n              cwd: projectDir,\n            })\n            await exec(\"sips\", [\"-s\", \"format\", \"png\", \"out.tiff\", \"--out\", `background${suffix}.png`], {\n              cwd: projectDir,\n            })\n          }\n\n          await extractPng(0, \"\")\n          await extractPng(1, \"@2x\")\n          await fs.unlink(path.join(resourceDir, \"background.tiff\"))\n        },\n      }\n    )\n  })\n\n  test.ifMac.skip(\"no Applications link\", ({ expect }) => {\n    return assertPack(expect, \"test-app-one\", {\n      targets: defaultTarget,\n      config: {\n        publish: null,\n        productName: \"No-ApplicationsLink\",\n        dmg: {\n          title: \"No Applications Link\",\n          contents: [\n            {\n              x: 110,\n              y: 150,\n            },\n            {\n              x: 410,\n              y: 440,\n              type: \"link\",\n              path: \"/Applications/TextEdit.app\",\n            },\n          ],\n        },\n      },\n      effectiveOptionComputed: async it => {\n        if (!(\"volumePath\" in it)) {\n          return false\n        }\n\n        const volumePath = it.volumePath\n        await Promise.all([\n          assertThat(expect, path.join(volumePath, \".background.tiff\")).isFile(),\n          assertThat(expect, path.join(volumePath, \"Applications\")).doesNotExist(),\n          assertThat(expect, path.join(volumePath, \"TextEdit.app\")).isSymbolicLink(),\n          assertThat(expect, path.join(volumePath, \"TextEdit.app\")).isDirectory(),\n        ])\n        expect(it.specification.contents).toMatchSnapshot()\n        return false\n      },\n    })\n  })\n\n  test.ifMac(\"unset dmg icon\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: dmgTarget,\n        config: {\n          publish: null,\n          // dmg can mount only one volume name, so, to test in parallel, we set different product name\n          productName: \"No_Volume_Icon\",\n          dmg: {\n            icon: null,\n          },\n        },\n      },\n      {\n        packed: context => {\n          return attachAndExecute(path.join(context.outDir, \"No_Volume_Icon-1.1.0.dmg\"), false, () => {\n            return Promise.all([\n              assertThat(expect, path.join(\"/Volumes/No_Volume_Icon 1.1.0/.background.tiff\")).isFile(),\n              assertThat(expect, path.join(\"/Volumes/No_Volume_Icon 1.1.0/.VolumeIcon.icns\")).doesNotExist(),\n            ])\n          })\n        },\n      }\n    )\n  )\n\n  // test also \"only dmg\"\n  test.ifMac(\"no background\", ({ expect }) =>\n    app(\n      expect,\n      {\n        targets: dmgTarget,\n        config: {\n          publish: null,\n          // dmg can mount only one volume name, so, to test in parallel, we set different product name\n          productName: \"No-Background\",\n          dmg: {\n            background: null,\n            title: \"Foo\",\n          },\n        },\n      },\n      {\n        packed: context => {\n          return attachAndExecute(path.join(context.outDir, \"No-Background-1.1.0.dmg\"), false, () => {\n            return assertThat(expect, path.join(\"/Volumes/No-Background 1.1.0/.background.tiff\")).doesNotExist()\n          })\n        },\n      }\n    )\n  )\n\n  // test also darkModeSupport\n  test.ifMac(\"bundleShortVersion\", ({ expect }) =>\n    app(expect, {\n      targets: dmgTarget,\n      config: {\n        publish: null,\n        // dmg can mount only one volume name, so, to test in parallel, we set different product name\n        productName: \"Bundle-ShortVersion\",\n        mac: {\n          bundleShortVersion: \"2017.1-alpha5\",\n          darkModeSupport: true,\n        },\n        dmg: {\n          title: \"bundleShortVersion\",\n        },\n      },\n    })\n  )\n\n  test.ifMac(\"disable dmg icon (light), bundleVersion\", ({ expect }) => {\n    return assertPack(expect, \"test-app-one\", {\n      targets: defaultTarget,\n      config: {\n        publish: null,\n        productName: \"Disable-Icon\",\n        dmg: {\n          icon: null,\n          title: \"Disable Icon\",\n        },\n        mac: {\n          bundleVersion: \"50\",\n        },\n      },\n      effectiveOptionComputed: async it => {\n        expect(it.specification.icon).toBeNull()\n        expect(it.packager.appInfo.buildVersion).toEqual(\"50\")\n        expect(await it.packager.getIconPath()).not.toBeNull()\n        return Promise.resolve(true)\n      },\n    })\n  })\n\n  const packagerOptions = (uniqueKey: number) => ({\n    targets: dmgTarget,\n    config: {\n      publish: null,\n      productName: \"Foo-\" + uniqueKey,\n      dmg: {\n        title: \"Foo \" + uniqueKey,\n      },\n    },\n  })\n\n  test.ifMac(\"multi language license\", ({ expect }) =>\n    app(expect, packagerOptions(1), {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          // writeFile(path.join(projectDir, \"build\", \"license_en.txt\"), \"Hi\"),\n          fs.writeFile(path.join(projectDir, \"build\", \"license_de.txt\"), \"Hallo\"),\n          fs.writeFile(path.join(projectDir, \"build\", \"license_ja.txt\"), \"こんにちは\"),\n        ])\n      },\n    })\n  )\n\n  test.ifMac(\"license ja\", ({ expect }) =>\n    app(expect, packagerOptions(2), {\n      projectDirCreated: projectDir => {\n        return fs.writeFile(path.join(projectDir, \"build\", \"license_ja.txt\"), \"こんにちは\".repeat(12))\n      },\n    })\n  )\n\n  test.ifMac(\"license en\", ({ expect }) =>\n    app(expect, packagerOptions(3), {\n      projectDirCreated: projectDir => {\n        return copyTestAsset(\"license_en.txt\", path.join(projectDir, \"build\", \"license_en.txt\"))\n      },\n    })\n  )\n\n  test.ifMac(\"license rtf\", ({ expect }) =>\n    app(expect, packagerOptions(4), {\n      projectDirCreated: projectDir => {\n        return copyTestAsset(\"license_de.rtf\", path.join(projectDir, \"build\", \"license_de.rtf\"))\n      },\n    })\n  )\n\n  test.ifMac(\"license buttons config\", ({ expect }) =>\n    app(\n      expect,\n      {\n        ...packagerOptions(5),\n        effectiveOptionComputed: async it => {\n          if (\"licenseData\" in it) {\n            // Clean `file` path from the data because the path is dynamic at runtime\n            it.licenseData.body.forEach((license: any) => {\n              delete license.file\n            })\n            expect(it.licenseData).toMatchSnapshot()\n          }\n          return Promise.resolve(false)\n        },\n      },\n      {\n        projectDirCreated: projectDir =>\n          Promise.all([\n            copyTestAsset(\"license_en.txt\", path.join(projectDir, \"build\", \"license_en.txt\")),\n            copyTestAsset(\"license_fr.txt\", path.join(projectDir, \"build\", \"license_fr.txt\")),\n            copyTestAsset(\"license_ja.txt\", path.join(projectDir, \"build\", \"license_ja.txt\")),\n            copyTestAsset(\"license_ko.txt\", path.join(projectDir, \"build\", \"license_ko.txt\")),\n            copyTestAsset(\"licenseButtons_en.yml\", path.join(projectDir, \"build\", \"licenseButtons_en.yml\")),\n            copyTestAsset(\"licenseButtons_fr.json\", path.join(projectDir, \"build\", \"licenseButtons_fr.json\")),\n            copyTestAsset(\"licenseButtons_ja.json\", path.join(projectDir, \"build\", \"licenseButtons_ja.json\")),\n            copyTestAsset(\"licenseButtons_ko.json\", path.join(projectDir, \"build\", \"licenseButtons_ko.json\")),\n          ]),\n      }\n    )\n  )\n})\n"]}