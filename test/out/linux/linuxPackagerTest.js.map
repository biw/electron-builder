{"version":3,"file":"linuxPackagerTest.js","sourceRoot":"","sources":["../../src/linux/linuxPackagerTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { GenericServerOptions } from \"builder-util-runtime\"\nimport { Arch, build, Platform } from \"electron-builder\"\nimport { outputFile } from \"fs-extra\"\nimport * as fs from \"fs/promises\"\nimport * as path from \"path\"\nimport { assertThat } from \"../helpers/fileAssert\"\nimport { app, appThrows, copyTestAsset, modifyPackageJson } from \"../helpers/packTester\"\nimport { ELECTRON_VERSION } from \"../helpers/testConfig\"\n\nconst appImageTarget = Platform.LINUX.createTarget(\"appimage\", Arch.x64)\n\n// test update info file name\nconst testPublishConfig: GenericServerOptions = {\n  provider: \"generic\",\n  url: \"https://example.com/download\",\n}\n\ntest.ifNotWindows(\"AppImage\", ({ expect }) =>\n  app(expect, {\n    targets: appImageTarget,\n    config: {\n      directories: {\n        // tslint:disable:no-invalid-template-strings\n        output: \"dist/${os}\",\n      },\n      downloadAlternateFFmpeg: true,\n      publish: testPublishConfig,\n      electronFuses: {\n        runAsNode: true,\n        enableCookieEncryption: true,\n        enableNodeOptionsEnvironmentVariable: true,\n        enableNodeCliInspectArguments: true,\n        enableEmbeddedAsarIntegrityValidation: true,\n        onlyLoadAppFromAsar: true,\n        loadBrowserProcessSpecificV8Snapshot: true,\n        grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n      },\n    },\n  })\n)\n\ntest.ifNotWindows.ifNotCiMac(\"AppImage arm, max compression\", ({ expect }) =>\n  app(expect, {\n    targets: Platform.LINUX.createTarget(\"Appimage\", Arch.armv7l),\n    config: {\n      publish: testPublishConfig,\n      compression: \"maximum\",\n    },\n  })\n)\n\ntest.ifNotWindows.ifNotCiMac(\"AppImage - deprecated systemIntegration\", ({ expect }) =>\n  appThrows(expect, {\n    targets: appImageTarget,\n    config: {\n      appImage: {\n        systemIntegration: \"doNotAsk\",\n      } as any,\n    },\n  })\n)\n\ntest.ifNotWindows.ifNotCiMac(\"text license and file associations\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        extraResources: {\n          from: \"build/icons\",\n        },\n        fileAssociations: [\n          {\n            ext: \"my-app\",\n            name: \"Test Foo\",\n            mimeType: \"application/x-example\",\n          },\n        ],\n      },\n    },\n    {\n      projectDirCreated: projectDir => {\n        return Promise.all([\n          // copy full text to test presentation\n          copyTestAsset(\"license_en.txt\", path.join(projectDir, \"build\", \"license.txt\")),\n        ])\n      },\n    }\n  )\n)\n\ntest.ifNotWindows.ifNotCiMac(\"html license\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n    },\n    {\n      projectDirCreated: projectDir => {\n        return outputFile(\n          path.join(projectDir, \"build\", \"license.html\"),\n          `\n        <html lang=\"en\">\n        <body>\n          <a href=\"https://example.com\">Test link</a>\n        </body>\n        </html>`\n        )\n      },\n    }\n  )\n)\n\ntest.ifNotWindows.ifNotCiMac(\"AppImage - default icon, custom executable and custom desktop\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        linux: {\n          executableName: \"Foo\",\n          // Example Spec: https://specifications.freedesktop.org/desktop-entry-spec/latest/example.html\n          desktop: {\n            entry: {\n              \"X-Foo\": \"bar\",\n              Terminal: \"true\",\n            },\n            desktopActions: {\n              Gallery: {\n                Exec: \"fooview --gallery\",\n                Name: \"Browse Gallery\",\n              },\n              Create: {\n                Exec: \"fooview --create-new\",\n                Name: \"Create a new Foo!\",\n                Icon: \"fooview-new\",\n              },\n              EmptyEntry: {},\n              NullEntry: null,\n            },\n          },\n        },\n        appImage: {\n          // tslint:disable-next-line:no-invalid-template-strings\n          artifactName: \"boo-${productName}\",\n        },\n        electronFuses: {\n          runAsNode: true,\n          enableCookieEncryption: true,\n          enableNodeOptionsEnvironmentVariable: true,\n          enableNodeCliInspectArguments: true,\n          enableEmbeddedAsarIntegrityValidation: true,\n          onlyLoadAppFromAsar: true,\n          loadBrowserProcessSpecificV8Snapshot: true,\n          grantFileProtocolExtraPrivileges: undefined, // unsupported on current electron version in our tests\n        },\n      },\n      effectiveOptionComputed: async it => {\n        const content: string = it.desktop\n        expect(\n          content\n            .split(\"\\n\")\n            .filter(it => !it.includes(\"X-AppImage-BuildId\") && !it.includes(\"X-AppImage-Version\"))\n            .join(\"\\n\")\n        ).toMatchSnapshot()\n        return false\n      },\n    },\n    {\n      projectDirCreated: it => fs.rm(path.join(it, \"build\"), { recursive: true, force: true }),\n      packed: async context => {\n        const projectDir = context.getContent(Platform.LINUX)\n        await assertThat(expect, path.join(projectDir, \"Foo\")).isFile()\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"icons from ICNS (mac)\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        publish: null,\n        mac: {\n          icon: \"resources/time.icns\",\n        },\n        // test https://github.com/electron-userland/electron-builder/issues/3510\n        linux: {\n          artifactName: \"app-${version}-${arch}.${ext}\",\n        },\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await fs\n          .mkdir(path.join(projectDir, \"resources\"), { recursive: true })\n          .then(() => fs.rename(path.join(projectDir, \"build\", \"icon.icns\"), path.join(projectDir, \"resources\", \"time.icns\")))\n        await fs.rm(path.join(projectDir, \"build\"), { recursive: true, force: true })\n      },\n      packed: async context => {\n        const projectDir = context.getResources(Platform.LINUX)\n        await assertThat(expect, projectDir).isDirectory()\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"icons from ICNS if nothing specified\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        publish: null,\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await fs.rm(path.join(projectDir, \"build\", \"icons\"), { recursive: true, force: true })\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"icons from dir and one icon with suffix\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        publish: null,\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await fs.copyFile(path.join(projectDir, \"build\", \"icons\", \"16x16.png\"), path.join(projectDir, \"build\", \"icons\", \"16x16-dev.png\"))\n      },\n      packed: async context => {\n        const projectDir = context.getResources(Platform.LINUX)\n        await assertThat(expect, projectDir).isDirectory()\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"icons dir with images without size in the filename\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        publish: null,\n        win: {\n          // doesn't matter, but just to be sure that presence of this configuration doesn't lead to errors\n          icon: \"icons/icon.ico\",\n        },\n      },\n    },\n    {\n      projectDirCreated: async projectDir => {\n        await fs.rename(path.join(projectDir, \"build\", \"icons\", \"256x256.png\"), path.join(projectDir, \"build\", \"icon.png\"))\n        await fs.rm(path.join(projectDir, \"build\", \"icons\"), { recursive: true, force: true })\n        await fs.rename(path.join(projectDir, \"build\"), path.join(projectDir, \"icons\"))\n      },\n      packed: async context => {\n        const projectDir = context.getResources(Platform.LINUX)\n        await assertThat(expect, projectDir).isDirectory()\n      },\n    }\n  )\n)\n\n// test prepacked asar also https://github.com/electron-userland/electron-builder/issues/1102\ntest.ifNotWindows(\"icons from ICNS\", ({ expect }) =>\n  app(\n    expect,\n    {\n      targets: appImageTarget,\n      config: {\n        publish: null,\n      },\n    },\n    {\n      projectDirCreated: it => fs.rm(path.join(it, \"build\", \"icons\"), { recursive: true, force: true }),\n      packed: async context => {\n        const projectDir = context.getResources(Platform.LINUX)\n\n        await fs.rm(path.join(projectDir, \"inspector\"), { recursive: true, force: true })\n\n        await build({\n          targets: appImageTarget,\n          projectDir,\n          publish: \"never\",\n          config: {\n            electronVersion: ELECTRON_VERSION,\n            compression: \"store\",\n            npmRebuild: false,\n          },\n        })\n\n        await assertThat(expect, path.join(projectDir, \"dist\")).isDirectory()\n      },\n    }\n  )\n)\n\ntest.ifNotWindows(\"no-author-email\", ({ expect }) =>\n  appThrows(\n    expect,\n    { targets: Platform.LINUX.createTarget(\"deb\", Arch.x64) },\n    {\n      projectDirCreated: projectDir =>\n        modifyPackageJson(projectDir, data => {\n          data.author = \"Foo\"\n        }),\n    }\n  )\n)\n\ntest.ifNotWindows(\"forbid desktop.Exec\", ({ expect }) =>\n  appThrows(expect, {\n    targets: appImageTarget,\n    config: {\n      linux: {\n        desktop: {\n          entry: {\n            Exec: \"foo\",\n          },\n        },\n      },\n    },\n  })\n)\n"]}