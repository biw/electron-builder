{"version":3,"file":"GitlabPublisherTest.js","sourceRoot":"","sources":["../../../src/publisher/gitlab/GitlabPublisherTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { CancellationToken, GitlabOptions } from \"builder-util-runtime\"\nimport { GitlabPublisher, PublishContext } from \"electron-publish\"\nimport { beforeEach, describe, test, vi } from \"vitest\"\nimport { GitlabTestFixtures } from \"./GitlabTestFixtures\"\n\n// Mock the HTTP executor to avoid real network calls\nvi.mock(\"builder-util\", async () => {\n  const actual = await vi.importActual(\"builder-util\")\n  return {\n    ...actual,\n    httpExecutor: {\n      doApiRequest: vi.fn(),\n      request: vi.fn(),\n    },\n  }\n})\n\ndescribe(\"GitLab Publisher - Unit Tests\", () => {\n  let publishContext: PublishContext\n\n  beforeEach(() => {\n    publishContext = {\n      cancellationToken: new CancellationToken(),\n      progress: null,\n    }\n    vi.clearAllMocks()\n  })\n\n  describe(\"Configuration\", () => {\n    describe(\"Authentication\", () => {\n      test(\"should throw error for missing token\", ({ expect }) => {\n        const env = GitlabTestFixtures.setupTestEnvironment()\n\n        try {\n          delete process.env.GITLAB_TOKEN\n\n          expect(() => {\n            new GitlabPublisher(\n              publishContext,\n              {\n                provider: \"gitlab\",\n                projectId: GitlabTestFixtures.PROJECTS.valid,\n              } as GitlabOptions,\n              GitlabTestFixtures.VERSIONS.valid\n            )\n          }).toThrow(GitlabTestFixtures.ERROR_PATTERNS.missingToken)\n        } finally {\n          env.restore()\n        }\n      })\n    })\n\n    describe(\"Project Configuration\", () => {\n      test(\"should handle string project ID\", ({ expect }) => {\n        const publisher = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            projectId: GitlabTestFixtures.PROJECTS.stringFormat,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        expect(publisher.toString()).toContain(GitlabTestFixtures.PROJECTS.stringFormat)\n      })\n\n      test(\"should handle numeric project ID\", ({ expect }) => {\n        const publisher = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            projectId: GitlabTestFixtures.PROJECTS.numericFormat,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        expect(publisher.toString()).toContain(String(GitlabTestFixtures.PROJECTS.numericFormat))\n      })\n    })\n\n    describe(\"Version Handling\", () => {\n      test(\"should reject version starting with 'v'\", ({ expect }) => {\n        expect(() => {\n          new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.invalidWithV)\n        }).toThrow(GitlabTestFixtures.ERROR_PATTERNS.invalidVersion)\n      })\n\n      test(\"should accept valid version\", ({ expect }) => {\n        const publisher = new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.valid)\n\n        expect(publisher.toString()).toContain(GitlabTestFixtures.VERSIONS.valid)\n      })\n\n      test(\"should accept version with build metadata\", ({ expect }) => {\n        const publisher = new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.validWithBuild)\n\n        expect(publisher.toString()).toContain(GitlabTestFixtures.VERSIONS.validWithBuild)\n      })\n\n      test(\"should handle vPrefixedTagName option\", ({ expect }) => {\n        const publisherWithPrefix = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            vPrefixedTagName: true,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        const publisherWithoutPrefix = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            vPrefixedTagName: false,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        expect(publisherWithPrefix.toString()).toContain(\"GitLab\")\n        expect(publisherWithoutPrefix.toString()).toContain(\"GitLab\")\n      })\n    })\n\n    describe(\"Host Configuration\", () => {\n      test(\"should use default host\", ({ expect }) => {\n        const publisher = new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.valid)\n\n        expect(publisher.toString()).toContain(\"GitLab\")\n      })\n\n      test(\"should use custom host\", ({ expect }) => {\n        const publisher = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            host: GitlabTestFixtures.HOSTS.custom,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        expect(publisher.toString()).toContain(\"GitLab\")\n      })\n\n      test(\"should use enterprise host\", ({ expect }) => {\n        const publisher = new GitlabPublisher(\n          publishContext,\n          GitlabTestFixtures.createOptions({\n            host: GitlabTestFixtures.HOSTS.enterprise,\n          }),\n          GitlabTestFixtures.VERSIONS.valid\n        )\n\n        expect(publisher.toString()).toContain(\"GitLab\")\n      })\n    })\n  })\n\n  describe(\"Publisher String Representation\", () => {\n    test(\"should return meaningful string representation\", ({ expect }) => {\n      const publisher = new GitlabPublisher(\n        publishContext,\n        GitlabTestFixtures.createOptions({\n          projectId: \"test-project\",\n        }),\n        \"1.2.3\"\n      )\n\n      const str = publisher.toString()\n      expect(str).toContain(\"GitLab\")\n      expect(str).toContain(\"test-project\")\n      expect(str).toContain(\"1.2.3\")\n    })\n  })\n\n  describe(\"Upload Target Configuration\", () => {\n    test(\"should default to project_upload method\", ({ expect }) => {\n      const publisher = new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.valid)\n\n      expect(publisher.toString()).toContain(\"GitLab\")\n    })\n\n    test(\"should accept generic_package upload target\", ({ expect }) => {\n      const publisher = new GitlabPublisher(\n        publishContext,\n        GitlabTestFixtures.createOptions({\n          uploadTarget: \"generic_package\",\n        }),\n        GitlabTestFixtures.VERSIONS.valid\n      )\n\n      expect(publisher.toString()).toContain(\"GitLab\")\n    })\n\n    test(\"should accept custom timeout\", ({ expect }) => {\n      const publisher = new GitlabPublisher(\n        publishContext,\n        GitlabTestFixtures.createOptions({\n          timeout: 60000,\n        }),\n        GitlabTestFixtures.VERSIONS.valid\n      )\n\n      expect(publisher.toString()).toContain(\"GitLab\")\n    })\n  })\n\n  describe(\"Provider Name\", () => {\n    test(\"should return correct provider name\", ({ expect }) => {\n      const publisher = new GitlabPublisher(publishContext, GitlabTestFixtures.createOptions(), GitlabTestFixtures.VERSIONS.valid)\n\n      expect(publisher.providerName).toBe(\"gitlab\")\n    })\n  })\n})\n"]}