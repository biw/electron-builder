{"version":3,"file":"concurrentBuildsTest.js","sourceRoot":"","sources":["../src/concurrentBuildsTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Configuration, DIR_TARGET, Platform } from \"app-builder-lib\"\nimport { deepAssign } from \"builder-util\"\nimport { TmpDir } from \"temp-file\"\nimport { assertPack, modifyPackageJson } from \"./helpers/packTester\"\n\nconst options = { timeout: 20 * 60 * 1000 }\n\nconst winTargets = Platform.WINDOWS.createTarget([DIR_TARGET, \"nsis\"], Arch.x64, Arch.arm64)\nconst macTargets = Platform.MAC.createTarget([DIR_TARGET, \"zip\", \"dmg\", \"mas\"], Arch.arm64, Arch.x64)\nconst linuxTargets = Platform.LINUX.createTarget([DIR_TARGET, \"AppImage\"], Arch.x64, Arch.armv7l)\n\nconst config: Configuration = {\n  productName: \"Test Concurrent\",\n  appId: \"test-concurrent\",\n  artifactName: \"${productName}-${version}-${arch}.${ext}\",\n  compression: \"store\",\n}\nconst projectDirCreated = async (projectDir: string, tmpDir: TmpDir) => {\n  const buildConfig = (data: any, isApp: boolean) => {\n    deepAssign(data, {\n      name: \"concurrent\", // needs to be lowercase for fpm targets (can't use default fixture TestApp)\n      version: \"1.1.0\",\n      ...(!isApp ? { build: config } : {}), // build config is only allowed in \"dev\" (root) package.json in two-package.json setups\n    })\n  }\n  await modifyPackageJson(projectDir, (data: any) => buildConfig(data, true), true)\n  await modifyPackageJson(projectDir, (data: any) => buildConfig(data, false), false)\n}\n\ntest.ifLinux(\"win/linux concurrent\", options, ({ expect }) => {\n  const targets = new Map([...winTargets, ...linuxTargets])\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n\ntest.ifMac(\"mac/win/linux concurrent\", options, ({ expect }) => {\n  const targets = new Map([...winTargets, ...macTargets, ...linuxTargets])\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n\ntest.ifMac(\"mac concurrent\", options, ({ expect }) => {\n  const targets = macTargets\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n\ntest.ifNotMac(\"win concurrent\", options, ({ expect }) => {\n  const targets = winTargets\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n\ntest.ifNotWindows(\"linux concurrent\", options, ({ expect }) => {\n  const targets = Platform.LINUX.createTarget([DIR_TARGET, \"rpm\", \"AppImage\"], Arch.x64, Arch.armv7l)\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n\ntest.ifWindows(\"win concurrent - all targets\", options, ({ expect }) => {\n  const targetList = [DIR_TARGET, `appx`, `nsis`, `portable`, `squirrel`, `7z`, `zip`, `tar.xz`, `tar.gz`, `tar.bz2`]\n  const targets = Platform.WINDOWS.createTarget(targetList, Arch.x64, Arch.arm64)\n  return assertPack(\n    expect,\n    \"test-app\",\n    {\n      targets,\n      config: {\n        concurrency: {\n          jobs: Object.keys(targets).length,\n        },\n        win: { target: targetList },\n        ...config,\n      },\n    },\n    {\n      projectDirCreated,\n    }\n  )\n})\n"]}