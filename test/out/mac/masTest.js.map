{"version":3,"file":"masTest.js","sourceRoot":"","sources":["../../src/mac/masTest.ts"],"names":[],"mappings":"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","sourcesContent":["import { Arch, Platform } from \"electron-builder\"\nimport * as path from \"path\"\nimport { CheckingMacPackager } from \"../helpers/CheckingPackager\"\nimport { assertPack, createMacTargetTest, signed } from \"../helpers/packTester\"\n\ndescribe.runIf(process.platform === \"darwin\" && process.env.CSC_KEY_PASSWORD != null)(\"mas\", () => {\n  test(\"mas\", ({ expect }) => createMacTargetTest(expect, [\"mas\"]))\n  test.ifNotCi(\"dev\", ({ expect }) => createMacTargetTest(expect, [\"mas-dev\"]))\n  test.ifNotCi(\"mas and 7z\", ({ expect }) => createMacTargetTest(expect, [\"mas\", \"7z\"]))\n\n  const entitlement = (fileName: string) => path.join(\"build\", fileName)\n  const entitlementsConfig = {\n    entitlements: entitlement(\"entitlements.mac.plist\"),\n    entitlementsInherit: entitlement(\"entitlements.mac.inherit.plist\"),\n    entitlementsLoginHelper: entitlement(\"entitlements.mac.login.plist\"),\n  }\n\n  const targets = Platform.MAC.createTarget(undefined, Arch.x64)\n\n  test.skip(\"custom mas\", ({ expect }) => {\n    let platformPackager: CheckingMacPackager | null = null\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      signed({\n        targets,\n        platformPackagerFactory: (packager, platform) => (platformPackager = new CheckingMacPackager(packager)),\n        config: {\n          mac: {\n            target: [\"mas\"],\n          },\n          mas: entitlementsConfig,\n        },\n      }),\n      {\n        checkMacApp(appDir, info) {\n          const appEntitlements = (filePath: string) => platformPackager!.effectiveSignOptions?.optionsForFile?.(filePath)\n          expect(appEntitlements(appDir)?.entitlements).toBe(entitlementsConfig.entitlements)\n          expect(appEntitlements(\"Library/LoginItems\")?.entitlements).toBe(entitlementsConfig.entitlementsLoginHelper)\n          expect(appEntitlements(\"anything\")?.entitlements).toBe(entitlementsConfig.entitlementsInherit)\n\n          expect(appEntitlements(appDir)?.hardenedRuntime).toBe(false)\n          return Promise.resolve()\n        },\n      }\n    )\n  })\n\n  test(\"entitlements in the package.json\", ({ expect }) => {\n    let platformPackager: CheckingMacPackager | null = null\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      signed({\n        targets,\n        platformPackagerFactory: (packager, platform) => (platformPackager = new CheckingMacPackager(packager)),\n        config: {\n          mac: entitlementsConfig,\n        },\n      }),\n      {\n        checkMacApp(appDir, info) {\n          const appEntitlements = (filePath: string) => platformPackager!.effectiveSignOptions?.optionsForFile?.(filePath)\n          expect(appEntitlements(appDir)?.entitlements).toBe(entitlementsConfig.entitlements)\n          expect(appEntitlements(\"Library/LoginItems\")?.entitlements).toBe(entitlementsConfig.entitlementsLoginHelper)\n          expect(appEntitlements(\"anything\")?.entitlements).toBe(entitlementsConfig.entitlementsInherit)\n\n          expect(appEntitlements(appDir)?.hardenedRuntime).toBe(true)\n          return Promise.resolve()\n        },\n      }\n    )\n  })\n\n  test(\"entitlements template\", ({ expect }) => {\n    let platformPackager: CheckingMacPackager | null = null\n    return assertPack(\n      expect,\n      \"test-app-one\",\n      signed({\n        targets,\n        platformPackagerFactory: (packager, platform) => (platformPackager = new CheckingMacPackager(packager)),\n      }),\n      {\n        checkMacApp(appDir, info) {\n          const appEntitlements = (filePath: string) => platformPackager!.effectiveSignOptions?.optionsForFile?.(filePath)\n          expect(appEntitlements(appDir)?.entitlements).toBe(entitlementsConfig.entitlements)\n          expect(appEntitlements(\"Library/LoginItems\")?.entitlements).toBe(entitlementsConfig.entitlements)\n          expect(appEntitlements(\"anything\")?.entitlements).toBe(entitlementsConfig.entitlements)\n          return Promise.resolve()\n        },\n      }\n    )\n  })\n})\n"]}